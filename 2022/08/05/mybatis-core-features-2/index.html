

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/MyInfo/%E5%A4%B4%E5%83%8F.jpg">
  <link rel="icon" href="/img/MyInfo/%E5%A4%B4%E5%83%8F.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yangtao">
  <meta name="keywords" content="">
  
    <meta name="description" content="引言MyBatis作为一个强大的持久层框架，提供了丰富的动态SQL功能，可以极大地提升SQL语句的灵活性和代码的可维护性。本文详细介绍了如何使用MyBatis提供的动态SQL标签来构建条件丰富且灵活的SQL查询，以及如何通过高级映射技术处理复杂的数据结构关系，使开发者能够更有效地管理和操作数据库。 动态SQLMyBatis允许在运行时根据一系列XML标签以及传入的参数值构建灵活的 SQL 语句，使">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis核心功能二">
<meta property="og:url" content="http://example.com/2022/08/05/mybatis-core-features-2/index.html">
<meta property="og:site_name" content="Yangtao&#39;s space">
<meta property="og:description" content="引言MyBatis作为一个强大的持久层框架，提供了丰富的动态SQL功能，可以极大地提升SQL语句的灵活性和代码的可维护性。本文详细介绍了如何使用MyBatis提供的动态SQL标签来构建条件丰富且灵活的SQL查询，以及如何通过高级映射技术处理复杂的数据结构关系，使开发者能够更有效地管理和操作数据库。 动态SQLMyBatis允许在运行时根据一系列XML标签以及传入的参数值构建灵活的 SQL 语句，使">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-1304850123.cos.ap-guangzhou.myqcloud.com/mybatis.jpg">
<meta property="article:published_time" content="2022-08-05T15:24:14.000Z">
<meta property="article:modified_time" content="2022-08-05T15:24:14.000Z">
<meta property="article:author" content="Yangtao">
<meta property="article:tag" content="MyBatis">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog-1304850123.cos.ap-guangzhou.myqcloud.com/mybatis.jpg">
  
  
  <title>MyBatis核心功能二 - Yangtao&#39;s space</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Programmer Yangtao</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                作者
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://blog-1304850123.cos.ap-guangzhou.myqcloud.com/mybatis.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="MyBatis核心功能二">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Yangtao
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-08-05 23:24" pubdate>
        2022年8月5日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      33k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      55 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">MyBatis核心功能二</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：3 年前
                
              </p>
            
            <div class="markdown-body">
              <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>MyBatis作为一个强大的持久层框架，提供了丰富的动态SQL功能，可以极大地提升SQL语句的灵活性和代码的可维护性。本文详细介绍了如何使用MyBatis提供的动态SQL标签来构建条件丰富且灵活的SQL查询，以及如何通过高级映射技术处理复杂的数据结构关系，使开发者能够更有效地管理和操作数据库。</p>
<h2 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h2><p>MyBatis允许在运行时根据一系列<code>XML</code>标签以及传入的参数值构建灵活的 SQL 语句，使得 SQL 语句的编写更加灵活和强大。</p>
<p>定义获取参数方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">getParams</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;() &#123;&#123;<br>        put(<span class="hljs-string">&quot;id&quot;</span>, <span class="hljs-number">1L</span>);<br>        put(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;zhangsan&quot;</span>);<br>    &#125;&#125;;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p><code>&lt;if&gt;</code>标签允许根据提供的表达式的结果（true or false）来决定是否包含一段特定的SQL。这样可以在执行SQL之前根据业务逻辑的需要动态构建SQL语句。</p>
<p>标签中<code>test</code>属性接受一个返回布尔值的表达式。MyBatis会评估这个表达式，并根据其返回结果决定是否包含 <code>&lt;if&gt;</code> 标签内的SQL片段。</p>
<p>在Mapper中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testIf&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    select * from tt_student where<br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;param.id != null and param.id != &#x27;&#x27;&quot;</span>&gt;</span><br>        and id = #&#123;param.id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testIf2&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    select * from tt_student where<br>    <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id != null and id != &#x27;&#x27;&quot;</span>&gt;</span><br>        and id = #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>定义对应接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">StudentPO <span class="hljs-title">testIf</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;param&quot;)</span> Map&lt;String, Object&gt; params)</span></span>;<br><br><span class="hljs-function">StudentPO <span class="hljs-title">testIf2</span><span class="hljs-params">(StudentPO studentPO)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;if标签测试：&#123;&#125;&quot;</span>, studentMapper.testIf(getParams()));<br>log.info(<span class="hljs-string">&quot;if标签测试2：&#123;&#125;&quot;</span>, studentMapper.testIf2(<span class="hljs-keyword">new</span> StudentPO().setId(<span class="hljs-number">1L</span>)));<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>23:04:42.881 [main] DEBUG space.yangtao.mapper.StudentMapper.testIf - ==&gt;  Preparing: select * from tt_student <span class="hljs-built_in">where</span> id = ?<br>23:04:42.898 [main] DEBUG space.yangtao.mapper.StudentMapper.testIf - ==&gt; Parameters: 1(Long)<br>23:04:42.933 [main] TRACE space.yangtao.mapper.StudentMapper.testIf - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:04:42.934 [main] TRACE space.yangtao.mapper.StudentMapper.testIf - &lt;==        Row: 1, 1, zhangsan, 176.1, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:04:42.937 [main] DEBUG space.yangtao.mapper.StudentMapper.testIf - &lt;==      Total: 1<br>23:04:42.938 [main] INFO  space.yangtao.client.StudentMapperTest - <span class="hljs-keyword">if</span>标签测试：StudentPO(id=1, name=zhangsan, height=176.1, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022)<br>23:04:42.939 [main] DEBUG space.yangtao.mapper.StudentMapper - Cache Hit Ratio [space.yangtao.mapper.StudentMapper]: 0.0<br>23:04:42.940 [main] DEBUG space.yangtao.mapper.StudentMapper.testIf2 - ==&gt;  Preparing: select * from tt_student <span class="hljs-built_in">where</span> id = ?<br>23:04:42.940 [main] DEBUG space.yangtao.mapper.StudentMapper.testIf2 - ==&gt; Parameters: 1(Long)<br>23:04:42.941 [main] TRACE space.yangtao.mapper.StudentMapper.testIf2 - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:04:42.941 [main] TRACE space.yangtao.mapper.StudentMapper.testIf2 - &lt;==        Row: 1, 1, zhangsan, 176.1, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:04:42.942 [main] DEBUG space.yangtao.mapper.StudentMapper.testIf2 - &lt;==      Total: 1<br>23:04:42.942 [main] INFO  space.yangtao.client.StudentMapperTest - <span class="hljs-keyword">if</span>标签测试2：StudentPO(id=1, name=zhangsan, height=176.1, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022)<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，当<code>&lt;if&gt;</code>标签中<code>test</code>表达式判断为true时，会自动拼接标签内的SQL语句。</p>
<h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><p>在上述<code>&lt;if&gt;</code>标签的例子中，如果<code>test</code>表达式判断为<code>false</code>，则不会拼接SQl语句<code>and ...</code>，但SQL语句中又以<code>where</code>结尾、存在语法错误，如</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;if标签测试：&#123;&#125;&quot;</span>, studentMapper.testIf(<span class="hljs-keyword">new</span> HashMap&lt;&gt;()));<br></code></pre></div></td></tr></table></figure>

<p>参数为空，运行结果如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">org.apache.ibatis.exceptions.PersistenceException: <br><span class="hljs-comment">### Error querying database.  Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27; at line 1</span><br><span class="hljs-comment">### The error may exist in space/yangtao/mapper/StudentMapper.xml</span><br><span class="hljs-comment">### The error may involve defaultParameterMap</span><br><span class="hljs-comment">### The error occurred while setting parameters</span><br><span class="hljs-comment">### SQL: select * from tt_student where</span><br><span class="hljs-comment">### Cause: java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;&#x27; at line 1</span><br></code></pre></div></td></tr></table></figure>

<p>MyBatis中提供了一个<code>&lt;where&gt;</code>标签，用于拼接<code>where</code>关键字，同时，这个标签会智能地处理<code>&lt;if&gt;</code>标签语句中的<code>and</code>关键字，当<code>where</code>标签中所有<code>if</code>标签判断都为<code>false</code>时，则不会拼接<code>where</code>，反之则会拼接。</p>
<p>在Mapper中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testWhere&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    select * from tt_student<br>    <span class="hljs-tag">&lt;<span class="hljs-name">where</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id != null and id != &#x27;&#x27;&quot;</span>&gt;</span><br>            and id = #&#123;id&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">where</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;StudentPO&gt; <span class="hljs-title">testWhere</span><span class="hljs-params">(Map&lt;String, Object&gt; params)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;where标签测试1：&#123;&#125;&quot;</span>, studentMapper.testWhere(<span class="hljs-keyword">new</span> HashMap&lt;&gt;()));<br>log.info(<span class="hljs-string">&quot;where标签测试2：&#123;&#125;&quot;</span>, studentMapper.testWhere(<span class="hljs-keyword">null</span>));<br>log.info(<span class="hljs-string">&quot;where标签测试3：&#123;&#125;&quot;</span>, studentMapper.testWhere(getParams()));<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>23:12:37.735 [main] DEBUG space.yangtao.mapper.StudentMapper.testWhere - ==&gt;  Preparing: select * from tt_student<br>23:12:37.753 [main] DEBUG space.yangtao.mapper.StudentMapper.testWhere - ==&gt; Parameters: <br>23:12:37.769 [main] TRACE space.yangtao.mapper.StudentMapper.testWhere - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:12:37.770 [main] TRACE space.yangtao.mapper.StudentMapper.testWhere - &lt;==        Row: 1, 1, zhangsan, 176.1, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:12:37.772 [main] TRACE space.yangtao.mapper.StudentMapper.testWhere - &lt;==        Row: 2, 2, zhangsan1, 180.0, 男, 1990-01-01, 2022-07-01 21:10:22<br>23:12:37.773 [main] TRACE space.yangtao.mapper.StudentMapper.testWhere - &lt;==        Row: 3, 2, zhangsan2, 180.0, 男, 1990-01-01, 2022-07-01 21:10:22<br>23:12:37.773 [main] DEBUG space.yangtao.mapper.StudentMapper.testWhere - &lt;==      Total: 3<br>23:12:37.774 [main] INFO  space.yangtao.client.StudentMapperTest - <span class="hljs-built_in">where</span>标签测试1：[StudentPO(id=1, name=zhangsan, height=176.1, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022), StudentPO(id=2, name=zhangsan1, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022), StudentPO(id=3, name=zhangsan2, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022)]<br>23:12:37.775 [main] DEBUG space.yangtao.mapper.StudentMapper - Cache Hit Ratio [space.yangtao.mapper.StudentMapper]: 0.0<br>23:12:37.775 [main] INFO  space.yangtao.client.StudentMapperTest - <span class="hljs-built_in">where</span>标签测试2：[StudentPO(id=1, name=zhangsan, height=176.1, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022), StudentPO(id=2, name=zhangsan1, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022), StudentPO(id=3, name=zhangsan2, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022)]<br>23:12:37.776 [main] DEBUG space.yangtao.mapper.StudentMapper - Cache Hit Ratio [space.yangtao.mapper.StudentMapper]: 0.0<br>23:12:37.776 [main] DEBUG space.yangtao.mapper.StudentMapper.testWhere - ==&gt;  Preparing: select * from tt_student WHERE id = ?<br>23:12:37.776 [main] DEBUG space.yangtao.mapper.StudentMapper.testWhere - ==&gt; Parameters: 1(Long)<br>23:12:37.777 [main] TRACE space.yangtao.mapper.StudentMapper.testWhere - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:12:37.777 [main] TRACE space.yangtao.mapper.StudentMapper.testWhere - &lt;==        Row: 1, 1, zhangsan, 176.1, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:12:37.778 [main] DEBUG space.yangtao.mapper.StudentMapper.testWhere - &lt;==      Total: 1<br>23:12:37.778 [main] INFO  space.yangtao.client.StudentMapperTest - <span class="hljs-built_in">where</span>标签测试3：[StudentPO(id=1, name=zhangsan, height=176.1, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022)]<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>&lt;where&gt;</code>标签会智能地处理标签内的SQL语句。</p>
<p>补充：<code>&lt;where&gt;</code>标签还能智能处理<code>&lt;if&gt;</code>标签中的条件连接符<code>and</code>、<code>or</code>。</p>
<h3 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h3><p><code>&lt;trim&gt;</code>标签用于对生成的SQL片段进行更细致的控制。它可以添加或删除特定的前缀、后缀以及前缀或后缀中的某些字符，特别适用于自定义和优化SQL语句的输出。</p>
<p>这个标签含有4个属性：</p>
<ul>
<li><strong>prefix</strong>：在生成的SQL片段前添加指定的前缀。</li>
<li><strong>prefixOverrides</strong>：移除生成的SQL片段前多余的指定前缀（如<code>AND</code>、<code>OR</code>）。</li>
<li><strong>suffix</strong>：在生成的SQL片段后添加指定的后缀。</li>
<li><strong>suffixOverrides</strong>：移除生成的SQL片段后多余的指定后缀。</li>
</ul>
<p>在Mapper中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testTrim&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    select * from tt_student<br>    <span class="hljs-comment">&lt;!-- |表示或 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">trim</span> <span class="hljs-attr">prefix</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">prefixOverrides</span>=<span class="hljs-string">&quot;where&quot;</span> <span class="hljs-attr">suffix</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">suffixOverrides</span>=<span class="hljs-string">&quot;and|or&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id != null and id != &#x27;&#x27;&quot;</span>&gt;</span><br>            id = #&#123;id&#125; and<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;other != null and other != &#x27;&#x27;&quot;</span>&gt;</span><br>            name = #&#123;other&#125; and<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">trim</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;StudentPO&gt; <span class="hljs-title">testTrim</span><span class="hljs-params">(Map&lt;String, Object&gt; params)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;trim标签测试：&#123;&#125;&quot;</span>, studentMapper.testTrim(getParams()));<br></code></pre></div></td></tr></table></figure>

<p>运行结果如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>23:16:21.582 [main] DEBUG space.yangtao.mapper.StudentMapper.testTrim - ==&gt;  Preparing: select * from tt_student <span class="hljs-built_in">where</span> id = ?<br>23:16:21.601 [main] DEBUG space.yangtao.mapper.StudentMapper.testTrim - ==&gt; Parameters: 1(Long)<br>23:16:21.615 [main] TRACE space.yangtao.mapper.StudentMapper.testTrim - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:16:21.617 [main] TRACE space.yangtao.mapper.StudentMapper.testTrim - &lt;==        Row: 1, 1, zhangsan, 176.1, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:16:21.618 [main] DEBUG space.yangtao.mapper.StudentMapper.testTrim - &lt;==      Total: 1<br>23:16:21.620 [main] INFO  space.yangtao.client.StudentMapperTest - trim标签测试：[StudentPO(id=1, name=zhangsan, height=176.1, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022)]<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>&lt;trim&gt;</code>标签已正确拼接以及删除前缀后缀<code>&lt;or&gt;</code>。</p>
<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p><code>&lt;set&gt;</code> 标签是一个专门用于动态生成<code>update</code>语句中的<code>set</code>部分的动态SQL标签。使用<code>&lt;set&gt;</code>标签可以便捷地构建含有条件性更新字段的SQL语句，同时自动处理列表前后的逗号，确保语法正确。</p>
<p>在Mapper中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testSet&quot;</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    update tt_student<br>    <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id != null and id != &#x27;&#x27;&quot;</span>&gt;</span><br>            id = #&#123;id&#125;,<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span><br>            name = #&#123;name&#125;,<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;height != null&quot;</span>&gt;</span><br>            height = #&#123;height&#125;,<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>    where id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">testSet</span><span class="hljs-params">(StudentPO studentPO)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>studentMapper.testSet(<span class="hljs-keyword">new</span> StudentPO().setId(<span class="hljs-number">1L</span>).setHeight(<span class="hljs-number">180.0</span>));<br>session.commit();<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>23:18:12.706 [main] DEBUG space.yangtao.mapper.StudentMapper.testSet - ==&gt;  Preparing: update tt_student SET id = ?, height = ? <span class="hljs-built_in">where</span> id = ?<br>23:18:12.723 [main] DEBUG space.yangtao.mapper.StudentMapper.testSet - ==&gt; Parameters: 1(Long), 180.0(Double), 1(Long)<br>23:18:12.730 [main] DEBUG space.yangtao.mapper.StudentMapper.testSet - &lt;==    Updates: 1<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>&lt;set&gt;</code>标签对不为空的参数进行了智能拼接，并且智能地处理了逗号。</p>
<h3 id="choose"><a href="#choose" class="headerlink" title="choose"></a>choose</h3><p><code>&lt;choose&gt;</code>标签提供了类似于Java中的<code>switch</code>关键字的功能，它用于在SQL映射文件中执行条件逻辑选择。这个标签允许在多个条件中选择一个执行。</p>
<p><code>choose</code>标签包括三个部分：</p>
<ul>
<li><code>when</code>：这相当于<code>switch</code>语句中的<code>case</code>，用于指定一个条件。</li>
<li><code>otherwise</code>：这相当于<code>switch</code>语句中的<code>default</code>，用于指定当没有任何<code>when</code>条件匹配时执行的操作。</li>
<li><code>choose</code>：这是包裹<code>when</code>和<code>otherwise</code>的容器标签。</li>
</ul>
<p>在Mapper中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testChoose&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    select * from tt_student<br>    <span class="hljs-tag">&lt;<span class="hljs-name">choose</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;id != null and id != &#x27;&#x27;&quot;</span>&gt;</span><br>            where id = #&#123;id&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">when</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span><br>            where name = #&#123;name&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">when</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">otherwise</span>&gt;</span><br>            where 1 = 1<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">otherwise</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">choose</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;StudentPO&gt; <span class="hljs-title">testChoose</span><span class="hljs-params">(Map&lt;String, Object&gt; params)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;choose标签测试1：&#123;&#125;&quot;</span>, studentMapper.testChoose(getParams()));<br>log.info(<span class="hljs-string">&quot;choose标签测试2：&#123;&#125;&quot;</span>, studentMapper.testChoose(<span class="hljs-keyword">null</span>));<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>23:20:50.736 [main] DEBUG space.yangtao.mapper.StudentMapper.testChoose - ==&gt;  Preparing: select * from tt_student <span class="hljs-built_in">where</span> id = ?<br>23:20:50.755 [main] DEBUG space.yangtao.mapper.StudentMapper.testChoose - ==&gt; Parameters: 1(Long)<br>23:20:50.768 [main] TRACE space.yangtao.mapper.StudentMapper.testChoose - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:20:50.769 [main] TRACE space.yangtao.mapper.StudentMapper.testChoose - &lt;==        Row: 1, 1, zhangsan, 180.0, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:20:50.771 [main] DEBUG space.yangtao.mapper.StudentMapper.testChoose - &lt;==      Total: 1<br>23:20:50.772 [main] INFO  space.yangtao.client.StudentMapperTest - choose标签测试1：[StudentPO(id=1, name=zhangsan, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022)]<br>23:20:50.773 [main] DEBUG space.yangtao.mapper.StudentMapper - Cache Hit Ratio [space.yangtao.mapper.StudentMapper]: 0.0<br>23:20:50.773 [main] DEBUG space.yangtao.mapper.StudentMapper.testChoose - ==&gt;  Preparing: select * from tt_student <span class="hljs-built_in">where</span> 1 = 1<br>23:20:50.773 [main] DEBUG space.yangtao.mapper.StudentMapper.testChoose - ==&gt; Parameters: <br>23:20:50.774 [main] TRACE space.yangtao.mapper.StudentMapper.testChoose - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:20:50.774 [main] TRACE space.yangtao.mapper.StudentMapper.testChoose - &lt;==        Row: 1, 1, zhangsan, 180.0, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:20:50.774 [main] TRACE space.yangtao.mapper.StudentMapper.testChoose - &lt;==        Row: 2, 2, zhangsan1, 180.0, 男, 1990-01-01, 2022-07-01 21:10:22<br>23:20:50.774 [main] TRACE space.yangtao.mapper.StudentMapper.testChoose - &lt;==        Row: 3, 2, zhangsan2, 180.0, 男, 1990-01-01, 2022-07-01 21:10:22<br>23:20:50.775 [main] DEBUG space.yangtao.mapper.StudentMapper.testChoose - &lt;==      Total: 3<br>23:20:50.775 [main] INFO  space.yangtao.client.StudentMapperTest - choose标签测试2：[StudentPO(id=1, name=zhangsan, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022), StudentPO(id=2, name=zhangsan1, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022), StudentPO(id=3, name=zhangsan2, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022)]<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>&lt;choose&gt;</code>标签会根据条件正确选择<code>where</code>条件。</p>
<h3 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h3><p><code>&lt;foreach&gt;</code>标签用于在SQL语句中处理集合和数组。这个标签允许你迭代一个集合，并为每个元素生成相应的SQL片段，如列表、IN查询条件或批量插入语句等。</p>
<p>在Mapper中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testForeach&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    select * from tt_student where id in<br>    <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">&quot;ids&quot;</span> <span class="hljs-attr">item</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">open</span>=<span class="hljs-string">&quot;(&quot;</span> <span class="hljs-attr">close</span>=<span class="hljs-string">&quot;)&quot;</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">&quot;,&quot;</span>&gt;</span><br>        #&#123;id&#125;<br>    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;StudentPO&gt; <span class="hljs-title">testForeach</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;ids&quot;)</span> List&lt;Long&gt; ids)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;foreach标签测试1：&#123;&#125;&quot;</span>, studentMapper.testForeach(Arrays.asList(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>)));<br>log.info(<span class="hljs-string">&quot;foreach标签测试2：&#123;&#125;&quot;</span>, studentMapper.testForeach(<span class="hljs-keyword">null</span>));<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>23:25:44.657 [main] DEBUG space.yangtao.mapper.StudentMapper.testForeach - ==&gt;  Preparing: select * from tt_student <span class="hljs-built_in">where</span> id <span class="hljs-keyword">in</span> ( ? , ? )<br>23:25:44.675 [main] DEBUG space.yangtao.mapper.StudentMapper.testForeach - ==&gt; Parameters: 1(Long), 2(Long)<br>23:25:44.690 [main] TRACE space.yangtao.mapper.StudentMapper.testForeach - &lt;==    Columns: id, class_id, name, height, gender, birthday, create_time<br>23:25:44.691 [main] TRACE space.yangtao.mapper.StudentMapper.testForeach - &lt;==        Row: 1, 1, zhangsan, 180.0, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:25:44.693 [main] TRACE space.yangtao.mapper.StudentMapper.testForeach - &lt;==        Row: 2, 2, zhangsan1, 180.0, 男, 1990-01-01, 2022-07-01 21:10:22<br>23:25:44.694 [main] DEBUG space.yangtao.mapper.StudentMapper.testForeach - &lt;==      Total: 2<br>23:25:44.695 [main] INFO  space.yangtao.client.StudentMapperTest - foreach标签测试1：[StudentPO(id=1, name=zhangsan, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022), StudentPO(id=2, name=zhangsan1, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022)]<br><br>org.apache.ibatis.exceptions.PersistenceException: <br><span class="hljs-comment">### Error querying database.  Cause: org.apache.ibatis.builder.BuilderException: The expression &#x27;ids&#x27; evaluated to a null value.</span><br><span class="hljs-comment">### Cause: org.apache.ibatis.builder.BuilderException: The expression &#x27;ids&#x27; evaluated to a null value.</span><br></code></pre></div></td></tr></table></figure>

<p>由日志可知，当传入集合不为空时，<code>&lt;foreach&gt;</code>标签会正确地为SQL拼接参数，当传入参数为null时，SQL处理则会出现异常，可以结合<code>&lt;if&gt;</code>标签处理集合为空的情况，如</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">if</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;ids != null and ids.size() &gt; 0&quot;</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- foreach 标签 --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">if</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<h3 id="sql和include"><a href="#sql和include" class="headerlink" title="sql和include"></a>sql和include</h3><p><code>&lt;sql&gt;</code>和<code>&lt;include&gt;</code>标签是用于复用SQL代码片段的强大工具。它们可以显著提高SQL语句的可维护性和可读性，尤其是在处理大量重复或结构相似的语句时。</p>
<p>在Mapper中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">sql</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;columnsSql&quot;</span>&gt;</span><br>    id,<br>    name,<br>    height,<br>    gender,<br>    birthday,<br>    create_time<br><span class="hljs-tag">&lt;/<span class="hljs-name">sql</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;testSqlInclude&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.po.StudentPO&quot;</span>&gt;</span><br>    select<br>    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">refid</span>=<span class="hljs-string">&quot;columnsSql&quot;</span>/&gt;</span><br>    from tt_student<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">List&lt;StudentPO&gt; <span class="hljs-title">testSqlInclude</span><span class="hljs-params">()</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;sqlInclude标签测试：&#123;&#125;&quot;</span>, studentMapper.testSqlInclude());<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>23:28:35.159 [main] DEBUG space.yangtao.mapper.StudentMapper.testSqlInclude - ==&gt;  Preparing: select id, name, height, gender, birthday, create_time from tt_student<br>23:28:35.178 [main] DEBUG space.yangtao.mapper.StudentMapper.testSqlInclude - ==&gt; Parameters: <br>23:28:35.192 [main] TRACE space.yangtao.mapper.StudentMapper.testSqlInclude - &lt;==    Columns: id, name, height, gender, birthday, create_time<br>23:28:35.194 [main] TRACE space.yangtao.mapper.StudentMapper.testSqlInclude - &lt;==        Row: 1, zhangsan, 180.0, 男, 1990-01-01, 2022-07-01 22:10:22<br>23:28:35.196 [main] TRACE space.yangtao.mapper.StudentMapper.testSqlInclude - &lt;==        Row: 2, zhangsan1, 180.0, 男, 1990-01-01, 2022-07-01 21:10:22<br>23:28:35.197 [main] TRACE space.yangtao.mapper.StudentMapper.testSqlInclude - &lt;==        Row: 3, zhangsan2, 180.0, 男, 1990-01-01, 2022-07-01 21:10:22<br>23:28:35.197 [main] DEBUG space.yangtao.mapper.StudentMapper.testSqlInclude - &lt;==      Total: 3<br>23:28:35.198 [main] INFO  space.yangtao.client.StudentMapperTest - sqlInclude标签测试：[StudentPO(id=1, name=zhangsan, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 22:10:22 CST 2022), StudentPO(id=2, name=zhangsan1, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022), StudentPO(id=3, name=zhangsan2, height=180.0, gender=男, birthday=Mon Jan 01 00:00:00 CST 1990, createTime=Fri Jul 01 21:10:22 CST 2022)]<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>&lt;include&gt;</code>标签已正确地将指定<code>&lt;sql&gt;</code>标签中的语句拼接到原SQL语句中。</p>
<h2 id="高级映射"><a href="#高级映射" class="headerlink" title="高级映射"></a>高级映射</h2><p>MyBatis提供了强大的映射功能，允许开发者在数据库操作中实现复杂的对象关系映射，包括一对多、多对一的关系。这些高级映射主要通过<code>&lt;resultMap&gt;</code>标签来配置，能够处理复杂的 SQL 查询结果并将它们正确地映射到Java对象和对象集合中。</p>
<p>创建一个班级表<code>tt_class</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">CREATE TABLE `tt_class`<br>(<br>    `id`          bigint      NOT NULL AUTO_INCREMENT COMMENT &#x27;主键ID&#x27;,<br>    `grade`       varchar(20) NOT NULL COMMENT &#x27;年级&#x27;,<br>    `no`          int         NOT NULL COMMENT &#x27;班级号&#x27;,<br>    PRIMARY KEY (`id`)<br>) ENGINE = InnoDB<br>  AUTO_INCREMENT = 1<br>  DEFAULT CHARSET = utf8mb4 COMMENT =&#x27;班级信息表&#x27;;<br></code></pre></div></td></tr></table></figure>

<p>为学生表添加字段<code>class_id</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">alter table tt_student add column class_id bigint not null comment &#x27;班级ID&#x27; after id;<br></code></pre></div></td></tr></table></figure>

<p>新增数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">INSERT INTO mybatis_db.tt_class (id, grade, no) VALUES (1, &#x27;一年级&#x27;, 1);<br>INSERT INTO mybatis_db.tt_class (id, grade, no) VALUES (2, &#x27;二年级&#x27;, 1);<br><br>INSERT INTO mybatis_db.tt_student (id, class_id, name, height, gender, birthday, create_time) VALUES (1, 1, &#x27;zhangsan&#x27;, 180, &#x27;男&#x27;, &#x27;1990-01-01&#x27;, &#x27;2024-07-01 22:10:22&#x27;);<br>INSERT INTO mybatis_db.tt_student (id, class_id, name, height, gender, birthday, create_time) VALUES (2, 2, &#x27;lisi&#x27;, 178.1, &#x27;男&#x27;, &#x27;1991-02-12&#x27;, &#x27;2024-07-02 22:33:24&#x27;);<br>INSERT INTO mybatis_db.tt_student (id, class_id, name, height, gender, birthday, create_time) VALUES (3, 2, &#x27;wangwu&#x27;, 172, &#x27;女&#x27;, &#x27;1991-04-21&#x27;, &#x27;2024-07-03 22:40:43&#x27;);<br></code></pre></div></td></tr></table></figure>

<p>整体数据如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">+----+--------+----+<br>| id | grade  | no |<br>+----+--------+----+<br>|  1 | 一年级 |  1 |<br>|  2 | 二年级 |  1 |<br>+----+--------+----+<br><br>+----+----------+----------+--------+--------+------------+---------------------+<br>| id | class_id | name     | height | gender | birthday   | create_time         |<br>+----+----------+----------+--------+--------+------------+---------------------+<br>|  1 |        1 | zhangsan |    180 | 男     | 1990-01-01 | 2024-07-01 22:10:22 |<br>|  2 |        2 | lisi     |  178.1 | 男     | 1991-02-12 | 2024-07-02 22:33:24 |<br>|  3 |        2 | wangwu   |    172 | 女     | 1991-04-21 | 2024-07-03 22:40:43 |<br>+----+----------+----------+--------+--------+------------+---------------------+<br></code></pre></div></td></tr></table></figure>

<h3 id="多对一"><a href="#多对一" class="headerlink" title="多对一"></a>多对一</h3><p>多对一映射用于处理一个对象属于另一个对象的情况，例如每个学生属于一个班级。</p>
<h4 id="实体类结构"><a href="#实体类结构" class="headerlink" title="实体类结构"></a>实体类结构</h4><p>现在要构造<code>StudentVO</code>，其中包含属性<code>ClassVO</code>，两个实体类结构如下</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassVO</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> String grade;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> no;<br><br>&#125;<br></code></pre></div></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentVO</span> </span>&#123;<br>    <br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-keyword">private</span> String name;<br><br>    <span class="hljs-keyword">private</span> ClassVO classVO;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">double</span> height;<br><br>&#125;<br></code></pre></div></td></tr></table></figure>

<h4 id="级联属性映射"><a href="#级联属性映射" class="headerlink" title="级联属性映射"></a>级联属性映射</h4><p>在Mapper中定义查询方法，同时定义一个<code>resultMap</code>，标签中含有对应的<code>classVO</code>的属性名与数据库字段名的映射</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scMap1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo.StudentVO&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;classVO.grade&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;grade&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;classVO.no&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;no&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;height&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;height&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getScVO1&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;scMap1&quot;</span>&gt;</span><br>    select s.id,<br>           s.name,<br>           c.grade,<br>           c.no,<br>           s.height<br>    from tt_student s<br>    left join tt_class c on s.class_id = c.id<br>    where s.id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">StudentVO <span class="hljs-title">getScVO1</span><span class="hljs-params">(Long id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;getScVO1：&#123;&#125;&quot;</span>, studentMapper.getScVO1(<span class="hljs-number">1L</span>));<br></code></pre></div></td></tr></table></figure>

<p>控制台打印日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>08:57:49.636 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO1 - ==&gt;  Preparing: select s.id, s.name, c.grade, c.no, s.height from tt_student s left join tt_class c on s.class_id = c.id <span class="hljs-built_in">where</span> s.id = ?<br>08:57:49.654 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO1 - ==&gt; Parameters: 1(Long)<br>08:57:49.685 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO1 - &lt;==    Columns: id, name, grade, no, height<br>08:57:49.686 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO1 - &lt;==        Row: 1, zhangsan, 一年级, 1, 180.0<br>08:57:49.687 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO1 - &lt;==      Total: 1<br>08:57:49.688 [main] INFO  space.yangtao.client.StudentMapperTest - getScVO1：StudentVO(id=1, name=zhangsan, classVO=ClassVO(grade=一年级, no=1), height=180.0)<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>StudentVO</code>对象中已包含<code>ClassVO</code>对象，<code>resultMap</code>已完成多对一属性映射。</p>
<h4 id="association"><a href="#association" class="headerlink" title="association"></a>association</h4><p><code>&lt;association&gt;</code>标签用于处理一对一的关系。它相当于Java中对象的嵌套，允许将查询结果的一部分映射到另一个对象的属性中。</p>
<ul>
<li><strong>property</strong>：Java对象中关联对象的属性名。</li>
<li><strong>javaType</strong>：关联对象的类型（全限定类名或别名）。</li>
<li><strong>column</strong>：用于关联查询的列名。</li>
<li><strong>select</strong>：指定分步查询的方法，全限定名。</li>
<li><strong>fetchType</strong>：加载方式，<code>lazy</code>（延迟加载）或<code>eager</code>（立即加载）。</li>
</ul>
<p>在Mapper文件中，同样定义<code>resultMap</code>，同时使用<code>association</code>标签，将学生对象中的<code>classVO</code>与数据库字段进行关联</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scMap2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo.StudentVO&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;height&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;height&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;classVO&quot;</span> <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo.ClassVO&quot;</span> <span class="hljs-attr">fetchType</span>=<span class="hljs-string">&quot;lazy&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;grade&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;grade&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;no&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;no&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getScVO2&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;scMap2&quot;</span>&gt;</span><br>    select s.id,<br>           s.name,<br>           c.grade,<br>           c.no,<br>           s.height<br>    from tt_student s<br>    left join tt_class c on s.class_id = c.id<br>    where s.id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">StudentVO <span class="hljs-title">getScVO2</span><span class="hljs-params">(Long id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;getScVO2：&#123;&#125;&quot;</span>, studentMapper.getScVO2(<span class="hljs-number">1L</span>));<br></code></pre></div></td></tr></table></figure>

<p>控制台打印日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>08:58:56.713 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO2 - ==&gt;  Preparing: select s.id, s.name, c.grade, c.no, s.height from tt_student s left join tt_class c on s.class_id = c.id <span class="hljs-built_in">where</span> s.id = ?<br>08:58:56.730 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO2 - ==&gt; Parameters: 1(Long)<br>08:58:56.744 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO2 - &lt;==    Columns: id, name, grade, no, height<br>08:58:56.744 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO2 - &lt;==        Row: 1, zhangsan, 一年级, 1, 180.0<br>08:58:56.745 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO2 - &lt;==      Total: 1<br>08:58:56.747 [main] INFO  space.yangtao.client.StudentMapperTest - getScVO2：StudentVO(id=1, name=zhangsan, classVO=ClassVO(grade=一年级, no=1), height=180.0)<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>StudentVO</code>对象中已包含<code>ClassVO</code>对象，<code>resultMap</code>已完成多对一属性映射。</p>
<h4 id="分步查询"><a href="#分步查询" class="headerlink" title="分步查询"></a>分步查询</h4><p>与前面两种方法不同，分布查询需要书写两条SQL语句，这种方法的优点是可复用、支持懒加载。</p>
<p>在<code>StudentMapper</code>中定义查询语句</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getVoById&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;scMap3&quot;</span>&gt;</span><br>    select s.id,<br>    s.class_id,<br>    s.name,<br>    s.height<br>    from tt_student s<br>    where s.id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>定义对应的<code>resultMap</code></p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;scMap3&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo.StudentVO&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">id</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;height&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;height&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">    association：关联，一个学生对应一个班级（需放在所有result之后）</span><br><span class="hljs-comment">    property：关联的属性</span><br><span class="hljs-comment">    javaType：关联的实体类</span><br><span class="hljs-comment">    column：主表与子表的关联字段</span><br><span class="hljs-comment">    select：子查询对应的接口方法（全类名）</span><br><span class="hljs-comment">    --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;classVO&quot;</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo.ClassVO&quot;</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;class_id&quot;</span></span><br><span class="hljs-tag">                 <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;space.yangtao.mapper.ClassMapper.getVoById&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">association</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>在<code>ClassMapper</code>中定义刚才声明的<code>getVoById</code>方法</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getVoById&quot;</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo.ClassVO&quot;</span>&gt;</span><br>    select * from tt_class where id = $&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>两个查询对应的接口方法分别为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">StudentVO <span class="hljs-title">getScVO3</span><span class="hljs-params">(Long id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-function">ClassVO <span class="hljs-title">getVoById</span><span class="hljs-params">(Long id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;getScVO3：&#123;&#125;&quot;</span>, studentMapper.getScVO3(<span class="hljs-number">1L</span>));<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>09:01:34.577 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO3 - ==&gt;  Preparing: select s.id, s.class_id, s.name, s.height from tt_student s <span class="hljs-built_in">where</span> s.id = 1<br>09:01:34.593 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO3 - ==&gt; Parameters: <br>09:01:34.605 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO3 - &lt;==    Columns: id, class_id, name, height<br>09:01:34.606 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO3 - &lt;==        Row: 1, 1, zhangsan, 180.0<br>09:01:34.607 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById - ====&gt;  Preparing: select * from tt_class <span class="hljs-built_in">where</span> id = ?<br>09:01:34.607 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById - ====&gt; Parameters: 1(Integer)<br>09:01:34.608 [main] TRACE space.yangtao.mapper.ClassMapper.getVoById - &lt;====    Columns: id, grade, no<br>09:01:34.608 [main] TRACE space.yangtao.mapper.ClassMapper.getVoById - &lt;====        Row: 1, 一年级, 1<br>09:01:34.609 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById - &lt;====      Total: 1<br>09:01:34.610 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO3 - &lt;==      Total: 1<br>09:01:34.610 [main] INFO  space.yangtao.client.StudentMapperTest - getScVO3：StudentVO(id=1, name=zhangsan, classVO=ClassVO(grade=一年级, no=1), height=180.0)<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>StudentVO</code>对象中已包含<code>ClassVO</code>对象，<code>resultMap</code>已完成多对一属性映射，同时可以看到进行了两次SQL查询。</p>
<p>拓展：单个Mapper方法开启延迟加载，修改<code>resultMap</code>中的<code>association</code>标签，添加属性<code>fetchType=&quot;lazy&quot;</code></p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">association</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;classVO&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">javaType</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo.ClassVO&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;class_id&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;space.yangtao.mapper.ClassMapper.getVoById&quot;</span></span><br><span class="hljs-tag">             <span class="hljs-attr">fetchType</span>=<span class="hljs-string">&quot;lazy&quot;</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>或开启全局延迟加载（注意单个Mapper配置会覆盖全局延迟加载配置，推荐项目开启全局延迟加载，特别的不需要延迟加载则单独设置<code>fetchType=&quot;eager&quot;</code>即可）</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">setting</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;lazyLoadingEnabled&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>运行测试程序：获取到学生对象后，只获取其名称，对于班级对象<code>classVO</code>不做操作</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>StudentMapper studentMapper = session.getMapper(StudentMapper.class);<br>log.info(<span class="hljs-string">&quot;getScVO3：&#123;&#125;&quot;</span>, studentMapper.getScVO3(<span class="hljs-number">1L</span>).getName());<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>09:03:01.035 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO3 - ==&gt;  Preparing: select s.id, s.class_id, s.name, s.height from tt_student s <span class="hljs-built_in">where</span> s.id = 1<br>09:03:01.055 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO3 - ==&gt; Parameters: <br>09:03:01.070 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO3 - &lt;==    Columns: id, class_id, name, height<br>09:03:01.070 [main] TRACE space.yangtao.mapper.StudentMapper.getScVO3 - &lt;==        Row: 1, 1, zhangsan, 180.0<br>09:03:01.103 [main] DEBUG space.yangtao.mapper.StudentMapper.getScVO3 - &lt;==      Total: 1<br>09:03:01.104 [main] INFO  space.yangtao.client.StudentMapperTest - getScVO3：zhangsan<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，MyBatis只对<code>tt_student</code>表进行了查询，而不再对<code>tt_class</code>进行查询，即只进行了一次查询，这是分布查询的一个优化点。</p>
<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><p>一对多映射用于处理一个对象关联多个其他对象的情况，例如一个班级有多个学生。</p>
<h4 id="实体类结构-1"><a href="#实体类结构-1" class="headerlink" title="实体类结构"></a>实体类结构</h4><p>重新设计学生和班级的实体类：<code>ClassVO</code>中含有一个<code>StudentVO</code>的集合</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StudentVO</span> </span>&#123;<br>    <br>    <span class="hljs-keyword">private</span> Long id;<br><br>    <span class="hljs-keyword">private</span> String name;<br>    <br>&#125;<br></code></pre></div></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ClassVO</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> String grade;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">int</span> no;<br><br>    <span class="hljs-keyword">private</span> List&lt;StudentVO&gt; students;<br><br>&#125;<br></code></pre></div></td></tr></table></figure>

<h4 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h4><p><code>&lt;collection&gt;</code>标签用于处理一对多的关系。这种标签允许你将查询结果的一部分映射到Java集合属性中。</p>
<ul>
<li><strong>property</strong>：Java对象中集合属性的名称。</li>
<li><strong>ofType</strong>：集合中元素的类型。</li>
<li><strong>select</strong>：指定分步查询的方法。</li>
<li><strong>column</strong>：用于关联查询的列名。</li>
</ul>
<p>在Mapper文件中定义SQL如下</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;getVoById2&quot;</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">&quot;csMap1&quot;</span>&gt;</span><br>    select c.grade,<br>           c.no,<br>           s.id,<br>           s.name<br>    from tt_class c<br>    left join tt_student s on s.class_id = c.id<br>    where c.id = #&#123;id&#125;<br><span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">space.yangtao.domain.vo2.<span class="hljs-function">ClassVO <span class="hljs-title">getVoById2</span><span class="hljs-params">(Long id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>定义对应的<code>resultMap</code>，使用<code>collection</code>标签指定集合</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;csMap1&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo2.ClassVO&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;grade&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;grade&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;no&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;no&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!-- 指定集合，property为属性名，ofType为属性的类型 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;students&quot;</span> <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo2.StudentVO&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;id&quot;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;name&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>运行测试程序</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>ClassMapper classMapper = session.getMapper(ClassMapper.class);<br>log.info(<span class="hljs-string">&quot;getCsVO1：&#123;&#125;&quot;</span>, classMapper.getVoById2(<span class="hljs-number">2L</span>));<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>09:04:52.321 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById2 - ==&gt;  Preparing: select c.grade, c.no, s.id, s.name from tt_class c left join tt_student s on s.class_id = c.id <span class="hljs-built_in">where</span> c.id = ?<br>09:04:52.339 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById2 - ==&gt; Parameters: 2(Long)<br>09:04:52.353 [main] TRACE space.yangtao.mapper.ClassMapper.getVoById2 - &lt;==    Columns: grade, no, id, name<br>09:04:52.353 [main] TRACE space.yangtao.mapper.ClassMapper.getVoById2 - &lt;==        Row: 二年级, 1, 2, zhangsan1<br>09:04:52.354 [main] TRACE space.yangtao.mapper.ClassMapper.getVoById2 - &lt;==        Row: 二年级, 1, 3, zhangsan2<br>09:04:52.354 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById2 - &lt;==      Total: 2<br>09:04:52.355 [main] INFO  space.yangtao.client.StudentMapperTest - getCsVO1：ClassVO(grade=二年级, no=1, students=[StudentVO(id=2, name=zhangsan1), StudentVO(id=3, name=zhangsan2)])<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>ClassVO</code>对象中已包含多个<code>StudentVO</code>对象，<code>resultMap</code>已完成一对多属性映射。</p>
<h4 id="分步查询-1"><a href="#分步查询-1" class="headerlink" title="分步查询"></a>分步查询</h4><p>在Mapper文件中定义SQL如下</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;select id=<span class="hljs-string">&quot;getVoById3&quot;</span> resultMap=<span class="hljs-string">&quot;csMap2&quot;</span>&gt;<br>    select c.grade,<br>    c.no,<br>    c.id as class_id<br>    from tt_class c<br>    where c.id = #&#123;id&#125;<br>&lt;/select&gt;<br></code></pre></div></td></tr></table></figure>

<p>对应的接口方法为</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">space.yangtao.domain.vo2.<span class="hljs-function">ClassVO <span class="hljs-title">getVoById3</span><span class="hljs-params">(Long id)</span></span>;<br></code></pre></div></td></tr></table></figure>

<p>定义<code>resultMap</code>，使用<code>collection</code>标签指定集合</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;csMap2&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo2.ClassVO&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;grade&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;grade&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">result</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;no&quot;</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;no&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">collection</span> <span class="hljs-attr">property</span>=<span class="hljs-string">&quot;students&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">ofType</span>=<span class="hljs-string">&quot;space.yangtao.domain.vo2.StudentVO&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">select</span>=<span class="hljs-string">&quot;space.yangtao.mapper.StudentMapper.getVoByClassId&quot;</span></span><br><span class="hljs-tag">                <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;class_id&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">collection</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">resultMap</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>在<code>StudentMapper</code>中定义刚才在<code>collection</code>中声明的<code>getVoByClassId</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">&lt;select id=<span class="hljs-string">&quot;getVoByClassId&quot;</span> resultType=<span class="hljs-string">&quot;space.yangtao.domain.vo2.StudentVO&quot;</span>&gt;<br>    select id, name from tt_student where class_id = #&#123;class_id&#125;<br>&lt;/select&gt;<br></code></pre></div></td></tr></table></figure>

<p>运行测试程序如下</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java">SqlSession session = SqlSessionUtil.getSession();<br>ClassMapper classMapper = session.getMapper(ClassMapper.class);<br>log.info(<span class="hljs-string">&quot;getCsVO2：&#123;&#125;&quot;</span>, classMapper.getVoById3(<span class="hljs-number">2L</span>));<br></code></pre></div></td></tr></table></figure>

<p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">...<br>09:06:14.124 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById3 - ==&gt;  Preparing: select c.grade, c.no, c.id as class_id from tt_class c <span class="hljs-built_in">where</span> c.id = ?<br>09:06:14.142 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById3 - ==&gt; Parameters: 2(Long)<br>09:06:14.153 [main] TRACE space.yangtao.mapper.ClassMapper.getVoById3 - &lt;==    Columns: grade, no, class_id<br>09:06:14.154 [main] TRACE space.yangtao.mapper.ClassMapper.getVoById3 - &lt;==        Row: 二年级, 1, 2<br>09:06:14.156 [main] DEBUG space.yangtao.mapper.StudentMapper - Cache Hit Ratio [space.yangtao.mapper.StudentMapper]: 0.0<br>09:06:14.156 [main] DEBUG space.yangtao.mapper.StudentMapper.getVoByClassId - ====&gt;  Preparing: select id, name from tt_student <span class="hljs-built_in">where</span> class_id = ?<br>09:06:14.156 [main] DEBUG space.yangtao.mapper.StudentMapper.getVoByClassId - ====&gt; Parameters: 2(Long)<br>09:06:14.157 [main] TRACE space.yangtao.mapper.StudentMapper.getVoByClassId - &lt;====    Columns: id, name<br>09:06:14.158 [main] TRACE space.yangtao.mapper.StudentMapper.getVoByClassId - &lt;====        Row: 2, zhangsan1<br>09:06:14.158 [main] TRACE space.yangtao.mapper.StudentMapper.getVoByClassId - &lt;====        Row: 3, zhangsan2<br>09:06:14.158 [main] DEBUG space.yangtao.mapper.StudentMapper.getVoByClassId - &lt;====      Total: 2<br>09:06:14.159 [main] DEBUG space.yangtao.mapper.ClassMapper.getVoById3 - &lt;==      Total: 1<br>09:06:14.160 [main] INFO  space.yangtao.client.StudentMapperTest - getCsVO2：ClassVO(grade=二年级, no=1, students=[StudentVO(id=2, name=zhangsan1), StudentVO(id=3, name=zhangsan2)])<br>...<br></code></pre></div></td></tr></table></figure>

<p>由日志可知，<code>ClassVO</code>对象中已包含多个<code>StudentVO</code>对象，<code>resultMap</code>已完成一对多属性映射。</p>
<p><strong>补充</strong>：跟多对一一样，一对多的分步查询页也支持延迟加载，且开启方式一致。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>通过学习本文，开发者不仅能够掌握MyBatis的动态SQL构建技巧，还能了解到如何通过高级映射技术实现一对多和多对一的关系映射。这些技术不仅优化了代码结构，也提高了开发效率和数据操作的灵活性。随着对MyBatis功能的深入理解，开发者将能更加自信地应用这些高级功能来设计和实现更复杂的数据库交互操作。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/MyBatis/">MyBatis</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/MyBatis/">MyBatis</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/08/mybatis-config/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">MyBatis配置</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/03/mybatis-core-features-1/">
                        <span class="hidden-mobile">MyBatis核心功能一</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'iyangtao/iyangtao.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <span>power by: </span> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span><u>Hexo</u></span></a> <span> - </span> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span><u>Fluid</u></span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>





  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize(null);
    }
  </script>




  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
