

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/MyInfo/%E5%A4%B4%E5%83%8F.jpg">
  <link rel="icon" href="/img/MyInfo/%E5%A4%B4%E5%83%8F.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yangtao">
  <meta name="keywords" content="">
  
    <meta name="description" content="引言在 Java 并发编程中，JDK 除了提供锁、线程池、并发容器等常见核心内容，还包含了一些用于特殊场景的工具类，以满足多线程协同工作的多种需求。LockSupport、CyclicBarrier、Phaser 与 Exchanger 等便是其中典型代表。它们在底层同步机制上各有巧妙设计，在不同应用场景下能发挥巨大作用。本文将带你系统认识这些工具类的工作原理、使用场景与常见示例，为日后编写更高效">
<meta property="og:type" content="article">
<meta property="og:title" content="Java并发编程——其他工具类补充">
<meta property="og:url" content="http://example.com/2021/08/19/javase-cp-other-utils/index.html">
<meta property="og:site_name" content="Yangtao&#39;s space">
<meta property="og:description" content="引言在 Java 并发编程中，JDK 除了提供锁、线程池、并发容器等常见核心内容，还包含了一些用于特殊场景的工具类，以满足多线程协同工作的多种需求。LockSupport、CyclicBarrier、Phaser 与 Exchanger 等便是其中典型代表。它们在底层同步机制上各有巧妙设计，在不同应用场景下能发挥巨大作用。本文将带你系统认识这些工具类的工作原理、使用场景与常见示例，为日后编写更高效">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-1304850123.cos.ap-guangzhou.myqcloud.com/java-concurrency-programming-logo.png">
<meta property="article:published_time" content="2021-08-19T08:30:12.000Z">
<meta property="article:modified_time" content="2021-08-19T08:30:12.000Z">
<meta property="article:author" content="Yangtao">
<meta property="article:tag" content="JavaSE">
<meta property="article:tag" content="Java并发编程">
<meta property="article:tag" content="并发工具类">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://blog-1304850123.cos.ap-guangzhou.myqcloud.com/java-concurrency-programming-logo.png">
  
  
  <title>Java并发编程——其他工具类补充 - Yangtao&#39;s space</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Programmer Yangtao</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                作者
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://blog-1304850123.cos.ap-guangzhou.myqcloud.com/java-concurrency-programming-logo.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Java并发编程——其他工具类补充">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Yangtao
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-08-19 16:30" pubdate>
        2021年8月19日 下午
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      15k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      26 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Java并发编程——其他工具类补充</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：3 年前
                
              </p>
            
            <div class="markdown-body">
              <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在 Java 并发编程中，JDK 除了提供锁、线程池、并发容器等常见核心内容，还包含了一些用于特殊场景的工具类，以满足多线程协同工作的多种需求。<code>LockSupport</code>、<code>CyclicBarrier</code>、<code>Phaser</code> 与 <code>Exchanger</code> 等便是其中典型代表。它们在底层同步机制上各有巧妙设计，在不同应用场景下能发挥巨大作用。本文将带你系统认识这些工具类的工作原理、使用场景与常见示例，为日后编写更高效更易维护的并发程序提供指引。</p>
<h2 id="LockSupport"><a href="#LockSupport" class="headerlink" title="LockSupport"></a>LockSupport</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><code>LockSupport</code> 提供了对线程阻塞和唤醒的底层支持，是构建高级同步工具（如 <code>Lock</code>、<code>Semaphore</code>、<code>CountDownLatch</code> 等）的基础，类似于操作系统中的线程调度机制。它通过维护每个线程的许可（<code>permit</code>）来控制线程的阻塞和唤醒，而不依赖于传统的监视器锁（如 <code>synchronized</code> 关键字）。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li><strong>许可机制</strong>：每个线程拥有一个许可，初始状态为无许可。<code>unpark</code> 方法会发放一个许可，<code>park</code> 方法会消耗一个许可。</li>
<li><strong>非阻塞的许可获取</strong>：即使在调用 <code>park</code> 之前调用了 <code>unpark</code>，也不会阻塞线程，因为许可已经存在。</li>
<li><strong>灵活性高</strong>：不像 <code>Object.wait</code> 和 <code>Object.notify</code> 依赖于监视器锁，<code>LockSupport</code> 的阻塞和唤醒操作是独立的，更加灵活。</li>
</ul>
<h3 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h3><ol>
<li><strong>阻塞线程</strong>：调用 <code>LockSupport.park()</code> 或其变种方法，使当前线程进入阻塞状态，等待被唤醒。</li>
<li><strong>唤醒线程</strong>：其他线程调用 <code>LockSupport.unpark(Thread thread)</code>，为目标线程发放一个许可，允许其继续执行。</li>
<li><strong>许可管理</strong>：每个线程的许可是独立管理的，多次调用 <code>unpark</code> 只会增加一个许可，而不会累积。</li>
</ol>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><code>LockSupport</code> 基于操作系统的底层线程调度机制，通过 JVM 提供的本地方法实现线程的阻塞和唤醒。它维护了每个线程的许可状态：</p>
<ul>
<li><strong>park</strong>：如果许可存在，消耗许可并返回；否则，将线程阻塞，等待许可的到来。</li>
<li><strong>unpark</strong>：为指定线程增加一个许可，如果线程已经阻塞，则唤醒它；否则，许可会被保存，后续的 <code>park</code> 调用会立即返回。</li>
</ul>
<p>这种许可机制避免了传统的基于监视器锁的阻塞方法（如 <code>wait/notify</code>）可能出现的竞态条件和死锁问题。</p>
<h3 id="常用-API"><a href="#常用-API" class="headerlink" title="常用 API"></a>常用 API</h3><h4 id="阻塞相关方法"><a href="#阻塞相关方法" class="headerlink" title="阻塞相关方法"></a>阻塞相关方法</h4><ul>
<li>**public static void park()**：阻塞当前线程，直到被唤醒或被中断。</li>
<li>**public static void park(Object blocker)**：阻塞当前线程，并关联一个阻塞器对象，便于调试和监控。</li>
<li>**public static void parkNanos(long nanos)**：阻塞当前线程，最多阻塞指定的纳秒时间。</li>
<li>**public static void parkUntil(long deadline)**：阻塞当前线程，直到指定的绝对时间（毫秒时间戳）。</li>
</ul>
<h4 id="唤醒相关方法"><a href="#唤醒相关方法" class="headerlink" title="唤醒相关方法"></a>唤醒相关方法</h4><ul>
<li>**public static void unpark(Thread thread)**：唤醒指定线程，发放一个许可。</li>
</ul>
<h4 id="许可相关方法"><a href="#许可相关方法" class="headerlink" title="许可相关方法"></a>许可相关方法</h4><ul>
<li>**public static boolean isBlocked(Thread thread)**：检查指定线程是否被阻塞（Java 9 引入）。</li>
<li>**public static Object getBlocker(Thread thread)**：获取阻塞线程的阻塞器对象（Java 9 引入）。</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li><strong>构建锁（Lock）</strong>：如 <code>ReentrantLock</code> 的内部实现依赖于 <code>LockSupport</code> 来阻塞和唤醒线程。</li>
<li><strong>实现线程池</strong>：线程池中的工作线程可能需要被阻塞，等待任务到来，然后被唤醒执行任务。</li>
<li><strong>构建信号量和屏障</strong>：如 <code>Semaphore</code> 和 <code>CyclicBarrier</code> 等同步器的实现。</li>
<li><strong>自定义阻塞队列</strong>：在实现“生产者-消费者模型”时，可以使用 <code>LockSupport</code> 控制生产者和消费者的阻塞与唤醒。</li>
</ul>
<h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>使用 <code>LockSupport</code> 阻塞和唤醒线程。</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LockSupportExample</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Thread blockerThread = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;当前线程调用 park()&quot;</span>);<br>            LockSupport.park();<br>            <span class="hljs-keyword">if</span> (Thread.interrupted()) &#123;<br>                log.info(<span class="hljs-string">&quot;线程检测到中断状态&quot;</span>);<br>            &#125;<br>            log.info(<span class="hljs-string">&quot;线程恢复&quot;</span>);<br>        &#125;);<br><br>        blockerThread.start();<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 确保 blockerThread 已经调用 park</span><br>            Thread.sleep(<span class="hljs-number">1000</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br><br>        log.info(<span class="hljs-string">&quot;主线程调用 unpark 唤醒 blockerThread&quot;</span>);<br>        LockSupport.unpark(blockerThread);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行程序，控制台输出如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-number">15</span>:<span class="hljs-number">01</span>:<span class="hljs-number">08.998</span> <span class="hljs-selector-attr">[Thread-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.LockSupportExample</span> - 当前线程调用 park()<br><span class="hljs-number">15</span>:<span class="hljs-number">01</span>:<span class="hljs-number">09.996</span> <span class="hljs-selector-attr">[main]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.LockSupportExample</span> - 主线程调用 unpark 唤醒 blockerThread<br><span class="hljs-number">15</span>:<span class="hljs-number">01</span>:<span class="hljs-number">09.996</span> <span class="hljs-selector-attr">[Thread-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.LockSupportExample</span> - 线程恢复<br></code></pre></div></td></tr></table></figure>

<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>并发编程中的许多阻塞方法如 <code>wait()</code>、<code>sleep()</code>、<code>join()</code> 在线程被中断时会抛出<code>InterruptedException</code>，但 <code>park</code> 和 <code>unpark</code> 不会，对已终止或不存在的线程调用 <code>unpark</code> 也不会报错，<code>park</code> 则会响应中断状态并且程序会重新从阻塞的地方开始执行。</li>
<li>使用 <code>LockSupport</code> 需要确保对同一线程调用的 <code>unpark</code> 不会丢失许可，即线程 <code>park</code> 之后一定要有其他线程调用 <code>unpark</code> 给线程分发许可，避免线程永久阻塞。</li>
</ul>
<h2 id="CyclicBarrier"><a href="#CyclicBarrier" class="headerlink" title="CyclicBarrier"></a>CyclicBarrier</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p><code>CyclicBarrier</code> 是Java提供的一个同步工具类，位于 <code>java.util.concurrent</code> 包中。它允许一组线程在某个同步点等待，直到所有线程都到达该同步点后，所有线程才能继续执行。这种机制非常适用于需要多线程协作完成某些阶段性任务的场景。</p>
<h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ul>
<li><strong>可重用性</strong>：<code>CyclicBarrier</code> 可以在所有线程通过屏障后重置，允许它被多次使用。</li>
<li><strong>屏障动作</strong>：在所有线程到达屏障点后，可以执行一个预定义的任务（屏障动作），该任务由一个 <code>Runnable</code> 对象定义。</li>
<li><strong>等待方式</strong>：线程可以选择阻塞等待所有其他线程到达屏障，或在等待超时时放弃等待。</li>
<li><strong>灵活性</strong>：适用于需要分阶段执行的并发任务，如并行计算、分布式任务协调等。</li>
</ul>
<h3 id="使用流程-1"><a href="#使用流程-1" class="headerlink" title="使用流程"></a>使用流程</h3><ol>
<li><strong>创建 CyclicBarrier 实例</strong>：指定参与屏障的线程数量，并可选地提供一个屏障动作。</li>
<li><strong>线程到达屏障点</strong>：每个线程在需要等待的地方调用 <code>await()</code> 方法，等待其他线程到达屏障。</li>
<li><strong>所有线程到达屏障</strong>：当所有参与的线程都调用了 <code>await()</code> 方法后，屏障被触发，所有线程继续执行后续操作，同时执行屏障动作（如果有）。</li>
<li><strong>重置屏障</strong>：<code>CyclicBarrier</code> 可以被重用，适用于多个循环或阶段。</li>
</ol>
<h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p><code>CyclicBarrier</code> 的内部机制主要基于一个计数器和一个等待队列。当创建 <code>CyclicBarrier</code> 时，指定了需要等待的线程数量（参与者数量）。每当一个线程调用 <code>await()</code> 方法时，计数器减 1。如果计数器仍然大于 0，线程将被阻塞，直到其他线程也调用了 <code>await()</code>。当计数器达到 0 时，所有被阻塞的线程将被唤醒，同时执行屏障动作（如果定义了）。</p>
<p><strong>关键点</strong>：</p>
<ul>
<li><strong>计数器管理</strong>：每调用一次 <code>await()</code>，计数器减 1。当计数器达到 0 时，重置计数器，允许<code>CyclicBarrier</code>再次被使用。</li>
<li><strong>屏障动作</strong>：<code>CyclicBarrier</code> 允许在所有线程到达屏障时执行一个额外的任务（屏障动作），该任务由一个 <code>Runnable</code> 对象定义。</li>
<li><strong>重用性</strong>：在所有线程通过屏障后，<code>CyclicBarrier</code> 会重置计数器，允许其再次被用于下一个循环或阶段。</li>
<li><strong>错误处理</strong>：如果在等待过程中，有线程中断或其他异常导致屏障破裂（<code>BrokenBarrierException</code>），所有等待的线程将抛出异常，确保不会永久阻塞。</li>
</ul>
<h3 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h3><h4 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h4><ul>
<li>**CyclicBarrier(int parties)**：创建一个 <code>CyclicBarrier</code>，指定参与屏障的线程数量（<code>parties</code>）。</li>
<li>**CyclicBarrier(int parties, Runnable barrierAction)**：创建一个 <code>CyclicBarrier</code>，指定参与屏障的线程数量，并定义一个屏障动作（<code>barrierAction</code>），当所有线程到达屏障点时执行。</li>
</ul>
<h4 id="主要方法"><a href="#主要方法" class="headerlink" title="主要方法"></a>主要方法</h4><ul>
<li>**int await()**：使当前线程等待，直到所有参与线程都调用了 <code>await()</code> 方法。成功通过屏障时，返回当前线程的屏障索引。</li>
<li>**int await(long timeout, TimeUnit unit)**：使当前线程等待，直到所有参与线程都调用了 <code>await()</code> 方法，或等待超时。如果超时，抛出 <code>TimeoutException</code>。</li>
<li>**boolean isBroken()**：查询屏障是否已经破裂。</li>
<li>**int getNumberWaiting()**：返回当前等待屏障的线程数量。</li>
<li>**int getParties()**：返回屏障的参与线程数量。</li>
</ul>
<h4 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h4><ul>
<li>**void reset()**：重置屏障，丢弃所有等待线程。所有等待的线程将抛出 <code>BrokenBarrierException</code>。</li>
</ul>
<h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><p><code>CyclicBarrier</code> 适用于需要多个线程协同完成某些阶段性任务的场景，以下是一些典型的应用场景：</p>
<ul>
<li><strong>分阶段计算</strong>：在并行计算中，数据被分成多个部分，由不同的线程处理。每个线程完成一部分计算后，需要等待其他线程完成，然后进行下一阶段的计算。</li>
<li><strong>模拟并发测试</strong>：在测试环境中，使用 <code>CyclicBarrier</code> 可以让多个线程同时开始执行某个任务，以模拟高并发场景，评估系统性能。</li>
<li><strong>多线程游戏开发</strong>：在游戏开发中，可能需要多个线程协同完成某些任务，如渲染、物理计算、AI决策等。<code>CyclicBarrier</code> 可以确保各个线程在每一帧同步更新。</li>
<li><strong>多线程数据处理</strong>：在数据处理系统中，可能需要多个线程并行处理数据的不同部分，完成后再汇总结果。<code>CyclicBarrier</code> 可以协调这些线程在每个处理阶段同步。</li>
</ul>
<h3 id="代码示例-1"><a href="#代码示例-1" class="headerlink" title="代码示例"></a>代码示例</h3><p>模拟多线程分阶段计算，四个工作线程需要完成三个阶段的计算。每完成一个阶段，所有线程都必须到达屏障点，屏障动作被执行，然后进入下一阶段。</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CyclicBarrierExample</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> NUM_THREADS = <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> CyclicBarrier barrier;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CyclicBarrierExample</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// 创建CyclicBarrier实例，指定4个参与线程，并定义屏障动作</span><br>        barrier = <span class="hljs-keyword">new</span> CyclicBarrier(NUM_THREADS, () -&gt; &#123;<br>            log.info(<span class="hljs-string">&quot;所有线程已到达屏障，开始执行屏障动作。&quot;</span>);<br>        &#125;);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">workerTask</span><span class="hljs-params">(<span class="hljs-keyword">int</span> workerId)</span> </span>&#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> phase = <span class="hljs-number">1</span>; phase &lt;= <span class="hljs-number">3</span>; phase++) &#123;<br>                log.info(<span class="hljs-string">&quot;Worker &quot;</span> + workerId + <span class="hljs-string">&quot; 正在执行阶段 &quot;</span> + phase + <span class="hljs-string">&quot; 的任务...&quot;</span>);<br>                Thread.sleep((<span class="hljs-keyword">long</span>) (Math.random() * <span class="hljs-number">1000</span>)); <span class="hljs-comment">// 模拟工作时间</span><br>                log.info(<span class="hljs-string">&quot;Worker &quot;</span> + workerId + <span class="hljs-string">&quot; 已完成阶段 &quot;</span> + phase + <span class="hljs-string">&quot; 的任务，等待其他线程...&quot;</span>);<br>                barrier.await(); <span class="hljs-comment">// 等待所有线程完成当前阶段</span><br>            &#125;<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">startWorkers</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= NUM_THREADS; i++) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> workerId = i;<br>            <span class="hljs-keyword">new</span> Thread(() -&gt; workerTask(workerId), <span class="hljs-string">&quot;Worker-&quot;</span> + workerId).start();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        CyclicBarrierExample example = <span class="hljs-keyword">new</span> CyclicBarrierExample();<br>        example.startWorkers();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行程序，控制台输出如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.328</span> <span class="hljs-selector-attr">[Worker-3]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">3</span> 正在执行阶段 <span class="hljs-number">1</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.328</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">2</span> 正在执行阶段 <span class="hljs-number">1</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.328</span> <span class="hljs-selector-attr">[Worker-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">1</span> 正在执行阶段 <span class="hljs-number">1</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.328</span> <span class="hljs-selector-attr">[Worker-4]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">4</span> 正在执行阶段 <span class="hljs-number">1</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.402</span> <span class="hljs-selector-attr">[Worker-4]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">4</span> 已完成阶段 <span class="hljs-number">1</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.498</span> <span class="hljs-selector-attr">[Worker-3]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">3</span> 已完成阶段 <span class="hljs-number">1</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.722</span> <span class="hljs-selector-attr">[Worker-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">1</span> 已完成阶段 <span class="hljs-number">1</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.863</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">2</span> 已完成阶段 <span class="hljs-number">1</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.863</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - 所有线程已到达屏障，开始执行屏障动作。<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.863</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">2</span> 正在执行阶段 <span class="hljs-number">2</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.863</span> <span class="hljs-selector-attr">[Worker-4]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">4</span> 正在执行阶段 <span class="hljs-number">2</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.863</span> <span class="hljs-selector-attr">[Worker-3]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">3</span> 正在执行阶段 <span class="hljs-number">2</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.863</span> <span class="hljs-selector-attr">[Worker-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">1</span> 正在执行阶段 <span class="hljs-number">2</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">00.998</span> <span class="hljs-selector-attr">[Worker-4]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">4</span> 已完成阶段 <span class="hljs-number">2</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.492</span> <span class="hljs-selector-attr">[Worker-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">1</span> 已完成阶段 <span class="hljs-number">2</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.768</span> <span class="hljs-selector-attr">[Worker-3]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">3</span> 已完成阶段 <span class="hljs-number">2</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.807</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">2</span> 已完成阶段 <span class="hljs-number">2</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.807</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - 所有线程已到达屏障，开始执行屏障动作。<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.807</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">2</span> 正在执行阶段 <span class="hljs-number">3</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.807</span> <span class="hljs-selector-attr">[Worker-4]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">4</span> 正在执行阶段 <span class="hljs-number">3</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.807</span> <span class="hljs-selector-attr">[Worker-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">1</span> 正在执行阶段 <span class="hljs-number">3</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">01.807</span> <span class="hljs-selector-attr">[Worker-3]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">3</span> 正在执行阶段 <span class="hljs-number">3</span> 的任务...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">02.376</span> <span class="hljs-selector-attr">[Worker-4]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">4</span> 已完成阶段 <span class="hljs-number">3</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">02.431</span> <span class="hljs-selector-attr">[Worker-2]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">2</span> 已完成阶段 <span class="hljs-number">3</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">02.496</span> <span class="hljs-selector-attr">[Worker-1]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">1</span> 已完成阶段 <span class="hljs-number">3</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">02.700</span> <span class="hljs-selector-attr">[Worker-3]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - Worker <span class="hljs-number">3</span> 已完成阶段 <span class="hljs-number">3</span> 的任务，等待其他线程...<br><span class="hljs-number">15</span>:<span class="hljs-number">29</span>:<span class="hljs-number">02.700</span> <span class="hljs-selector-attr">[Worker-3]</span> INFO  s<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.aqs</span><span class="hljs-selector-class">.CyclicBarrierExample</span> - 所有线程已到达屏障，开始执行屏障动作。<br></code></pre></div></td></tr></table></figure>

<h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>线程中断</strong>：如果在等待过程中，某个线程被中断，<code>CyclicBarrier</code> 会破裂（<code>isBroken()</code> 返回 <code>true</code>），其他等待的线程将抛出 <code>BrokenBarrierException</code>。需要处理好异常，避免程序崩溃。</li>
<li><strong>确保所有线程都到达屏障</strong>：如果某个线程永远不会调用 <code>await()</code>，其他线程将永久等待，导致死锁。需要确保所有参与线程都能正常到达屏障点。</li>
<li><strong>屏障动作的执行</strong>：屏障动作由一个独立的线程执行，通常是最后一个到达屏障的线程。如果屏障动作抛出异常，会导致 <code>CyclicBarrier</code> 破裂，影响其他等待线程。</li>
<li><strong>重用性</strong>：<code>CyclicBarrier</code> 是可重用的，可以在多次循环中使用，但需要确保每次使用时所有参与线程都能正确调用<code>await()</code>。</li>
</ul>
<h2 id="Phaser"><a href="#Phaser" class="headerlink" title="Phaser"></a>Phaser</h2><h3 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h3><p><code>Phaser</code> 是一种可重用的同步器，支持多阶段（<code>phase</code>）的任务执行，并允许动态地注册和注销参与的线程。它主要用于协调一组线程在多个阶段上的同步点，确保所有参与线程在每个阶段完成后再进入下一个阶段。</p>
<h3 id="特点-2"><a href="#特点-2" class="headerlink" title="特点"></a>特点</h3><ul>
<li><strong>多阶段同步</strong>：支持多个同步点（阶段），每个阶段结束后进入下一个阶段。</li>
<li><strong>动态参与</strong>：可以在运行时动态地增加或减少参与的线程数。</li>
<li><strong>可重复使用</strong>：类似于 <code>CyclicBarrier</code>，<code>Phaser</code> 可以在多个阶段重复使用。</li>
<li><strong>灵活性高</strong>：提供了更多的控制方法，如提前终止、获取当前阶段等。</li>
</ul>
<h3 id="使用流程-2"><a href="#使用流程-2" class="headerlink" title="使用流程"></a>使用流程</h3><ol>
<li><strong>创建 Phaser 实例</strong>：指定初始参与者数量，或者使用默认构造方法后动态注册。</li>
<li><strong>注册参与者</strong>：通过构造时指定或在运行时调用 <code>register()</code> 方法增加参与者。</li>
<li><strong>执行阶段任务</strong>：每个参与者在完成当前阶段的任务后，调用 <code>arriveAndAwaitAdvance()</code> 等方法，等待其他参与者到达同步点。</li>
<li><strong>进入下一阶段</strong>：所有参与者到达同步点后，<code>Phaser</code> 进入下一阶段，参与者继续执行下一阶段的任务。</li>
<li><strong>注销参与者</strong>：任务完成后，参与者可以调用 <code>arriveAndDeregister()</code> 方法注销，减少参与者数量。</li>
<li><strong>终止 Phaser</strong>：当所有阶段任务完成或需要提前终止时，可以调用 <code>forceTermination()</code> 或其他终止方法。</li>
</ol>
<h3 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h3><p><code>Phaser</code> 的内部实现基于可变的参与者数量和阶段计数。它维护一个阶段计数器（<code>phase</code>），以及当前阶段需要到达的参与者数量。当参与者调用同步方法（如 <code>arriveAndAwaitAdvance()</code>）时，<code>Phaser</code> 会记录到达的参与者数量，并在所有参与者到达后，递增阶段计数器，释放所有等待的线程，进入下一阶段。</p>
<p><strong>主要机制</strong>：</p>
<ul>
<li><strong>阶段（Phase）</strong>：表示同步的当前阶段，每完成一个阶段后递增。</li>
<li><strong>参与者（Parties）</strong>：需要同步的线程数量，可以动态增加或减少。</li>
<li><strong>到达（Arrive）</strong>：参与者完成当前阶段的任务，通知 <code>Phaser</code>。</li>
<li><strong>等待（Await）</strong>：参与者等待其他参与者到达同步点。</li>
<li><strong>注销（Deregister）</strong>：参与者完成所有任务后，从 <code>Phaser</code> 中注销，减少参与者数量。</li>
</ul>
<h3 id="常用-API-1"><a href="#常用-API-1" class="headerlink" title="常用 API"></a>常用 API</h3><h4 id="构造方法-1"><a href="#构造方法-1" class="headerlink" title="构造方法"></a>构造方法</h4><ul>
<li>**Phaser()**：创建一个未注册任何参与者的 <code>Phaser</code>。</li>
<li>**Phaser(int parties)**：创建一个并注册指定数量参与者的 <code>Phaser</code>。</li>
</ul>
<h4 id="注册和注销"><a href="#注册和注销" class="headerlink" title="注册和注销"></a>注册和注销</h4><ul>
<li>**int register()**：动态注册一个参与者，返回当前阶段。</li>
<li>**int bulkRegister(int parties)**：动态注册多个参与者。</li>
<li>**int arriveAndDeregister()**：到达同步点并注销当前参与者。</li>
<li>**int deregister()**：仅注销当前参与者，不到达同步点。</li>
</ul>
<h4 id="阶段到达与等待"><a href="#阶段到达与等待" class="headerlink" title="阶段到达与等待"></a>阶段到达与等待</h4><ul>
<li>**int arrive()**：到达同步点，不等待其他参与者。</li>
<li>**int arriveAndAwaitAdvance()**：到达同步点，并等待其他参与者到达后进入下一阶段。</li>
<li>**int arriveAndDeregister()**：到达同步点，并注销当前参与者。</li>
<li>**onAdvance(int phase, int registeredParties)**：在每次到达同步点时自定义额外的行为或者决定是否终止 phaser。</li>
</ul>
<h4 id="查询状态"><a href="#查询状态" class="headerlink" title="查询状态"></a>查询状态</h4><ul>
<li>**int getPhase()**：获取当前阶段数。</li>
<li>**int getRegisteredParties()**：获取当前注册的参与者数量。</li>
<li>**int getArrivedParties()**：获取当前阶段已到达的参与者数量。</li>
<li>**boolean isTerminated()**：检查 <code>Phaser</code> 是否已终止。</li>
</ul>
<h4 id="终止控制"><a href="#终止控制" class="headerlink" title="终止控制"></a>终止控制</h4><ul>
<li>**boolean forceTermination()**：强制终止 <code>Phaser</code>，所有等待的线程会被释放。</li>
</ul>
<h3 id="应用场景-2"><a href="#应用场景-2" class="headerlink" title="应用场景"></a>应用场景</h3><p><code>Phaser</code> 适用于以下场景：</p>
<ul>
<li><strong>多阶段任务协调</strong>：如分阶段的计算任务，每个阶段需要所有参与者完成后再进入下一阶段。</li>
<li><strong>动态参与者管理</strong>：参与者数量在运行时可能会变化，例如任务池中动态增加或减少工作线程。</li>
<li><strong>复杂的同步需求</strong>：需要多个同步点或条件，<code>Phaser</code> 提供了更高的灵活性。</li>
<li><strong>分布式系统中的同步</strong>：在分布式计算中，不同节点可能需要在不同阶段进行同步。</li>
</ul>
<h3 id="代码示例-2"><a href="#代码示例-2" class="headerlink" title="代码示例"></a>代码示例</h3><p>动态的注册参与者。</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhaserExample</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Phaser phaser = <span class="hljs-keyword">new</span> Phaser(<span class="hljs-number">1</span>); <span class="hljs-comment">// 主线程注册</span><br><br>        <span class="hljs-comment">// 主线程创建并启动2个子线程</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">2</span>; i++) &#123;<br>            <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> threadId = i;<br>            phaser.register(); <span class="hljs-comment">// 动态注册参与者</span><br>            <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>                System.out.println(<span class="hljs-string">&quot;Thread &quot;</span> + threadId + <span class="hljs-string">&quot; - 阶段1开始&quot;</span>);<br>                <span class="hljs-comment">// 模拟阶段1的工作</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">500</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                System.out.println(<span class="hljs-string">&quot;Thread &quot;</span> + threadId + <span class="hljs-string">&quot; - 阶段1完成，等待其他线程&quot;</span>);<br>                phaser.arriveAndAwaitAdvance();<br><br>                System.out.println(<span class="hljs-string">&quot;Thread &quot;</span> + threadId + <span class="hljs-string">&quot; - 阶段2开始&quot;</span>);<br>                <span class="hljs-comment">// 模拟阶段2的工作</span><br>                <span class="hljs-keyword">try</span> &#123;<br>                    Thread.sleep(<span class="hljs-number">500</span>);<br>                &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>                System.out.println(<span class="hljs-string">&quot;Thread &quot;</span> + threadId + <span class="hljs-string">&quot; - 阶段2完成，等待其他线程&quot;</span>);<br>                phaser.arriveAndAwaitAdvance();<br><br>                phaser.arriveAndDeregister(); <span class="hljs-comment">// 到达并注销</span><br>            &#125;).start();<br>        &#125;<br><br>        <span class="hljs-comment">// 主线程也参与同步</span><br>        System.out.println(<span class="hljs-string">&quot;Main thread - 阶段1等待&quot;</span>);<br>        phaser.arriveAndAwaitAdvance();<br><br>        System.out.println(<span class="hljs-string">&quot;Main thread - 阶段2等待&quot;</span>);<br>        phaser.arriveAndAwaitAdvance();<br><br>        phaser.arriveAndDeregister(); <span class="hljs-comment">// 主线程注销</span><br><br>        System.out.println(<span class="hljs-string">&quot;所有阶段完成，Phaser 终止&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行程序，控制台输出如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">30.540</span> <span class="hljs-selector-attr">[Thread-2]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">2</span> - 阶段<span class="hljs-number">1</span>开始<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">30.540</span> <span class="hljs-selector-attr">[Thread-1]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">1</span> - 阶段<span class="hljs-number">1</span>开始<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">30.540</span> <span class="hljs-selector-attr">[main]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Main thread - 阶段<span class="hljs-number">1</span>等待<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.044</span> <span class="hljs-selector-attr">[Thread-1]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">1</span> - 阶段<span class="hljs-number">1</span>完成，等待其他线程<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.044</span> <span class="hljs-selector-attr">[Thread-2]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">2</span> - 阶段<span class="hljs-number">1</span>完成，等待其他线程<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.044</span> <span class="hljs-selector-attr">[Thread-2]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">2</span> - 阶段<span class="hljs-number">2</span>开始<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.044</span> <span class="hljs-selector-attr">[Thread-1]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">1</span> - 阶段<span class="hljs-number">2</span>开始<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.044</span> <span class="hljs-selector-attr">[main]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Main thread - 阶段<span class="hljs-number">2</span>等待<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.557</span> <span class="hljs-selector-attr">[Thread-1]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">1</span> - 阶段<span class="hljs-number">2</span>完成，等待其他线程<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.557</span> <span class="hljs-selector-attr">[Thread-2]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - Thread <span class="hljs-number">2</span> - 阶段<span class="hljs-number">2</span>完成，等待其他线程<br><span class="hljs-number">15</span>:<span class="hljs-number">53</span>:<span class="hljs-number">31.557</span> <span class="hljs-selector-attr">[main]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.PhaserExample</span> - 所有阶段完成，Phaser 终止<br></code></pre></div></td></tr></table></figure>

<h3 id="注意事项-2"><a href="#注意事项-2" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>避免死锁</strong>：确保所有注册的参与者都能到达同步点，否则会导致永久等待。</li>
<li><strong>动态调整参与者</strong>：在多线程环境下动态注册和注销参与者时，需要小心管理，避免竞态条件。</li>
<li><strong>中断处理</strong>：<code>Phaser</code> 的同步方法不会抛出 <code>InterruptedException</code>，需要手动检查中断状态。</li>
<li><strong>资源管理</strong>：使用完 <code>Phaser</code> 后，确保所有参与者已注销，避免资源泄漏。</li>
</ul>
<h2 id="Exchanger"><a href="#Exchanger" class="headerlink" title="Exchanger"></a>Exchanger</h2><h3 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h3><p><code>Exchanger&lt;V&gt;</code> 是一个用于两个线程之间交换数据的同步点。它允许两个线程在某个同步点相遇，并交换彼此持有的数据。每个线程在调用 <code>exchange</code> 方法时，会阻塞直到另一个线程也到达该同步点，随后两者交换数据并继续执行。</p>
<h3 id="特点-3"><a href="#特点-3" class="headerlink" title="特点"></a>特点</h3><ul>
<li><strong>双线程交换</strong>：<code>Exchanger</code> 设计用于两个线程之间的数据交换，不适用于多于两个线程的场景。</li>
<li><strong>同步点</strong>：两个线程必须在同一个同步点到达，才能进行数据交换。</li>
<li><strong>阻塞与超时</strong>：线程在等待交换时会阻塞，可以选择设置超时时间以避免无限等待。</li>
<li><strong>可重复使用</strong>：<code>Exchanger</code> 可以在多次交换中重复使用，不需要为每次交换创建新的实例。</li>
</ul>
<h3 id="使用流程-3"><a href="#使用流程-3" class="headerlink" title="使用流程"></a>使用流程</h3><ol>
<li><strong>创建 Exchanger 实例</strong>：指定交换的数据类型。</li>
<li><strong>准备数据</strong>：每个线程准备好要交换的数据。</li>
<li><strong>调用 exchange 方法</strong>：线程调用 <code>exchange</code> 方法，传入要交换的数据，并接收对方线程传回的数据。</li>
<li><strong>处理交换结果</strong>：线程获取到对方线程传回的数据后，继续执行后续操作。</li>
</ol>
<h3 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h3><p><code>Exchanger</code> 内部维护了一个同步点，当两个线程调用 <code>exchange</code> 方法时：</p>
<ol>
<li>第一个到达的线程会在同步点等待，直到第二个线程也到达。</li>
<li>当第二个线程到达时，<code>Exchanger</code> 会将两个线程传入的数据进行交换。</li>
<li>两个线程各自接收对方传入的数据，然后继续执行。</li>
</ol>
<p><code>Exchanger</code> 的实现基于 <code>AbstractQueuedSynchronizer</code>（AQS），利用其状态管理和队列机制来控制线程的阻塞和唤醒。</p>
<h3 id="常用-API-2"><a href="#常用-API-2" class="headerlink" title="常用 API"></a>常用 API</h3><h4 id="构造方法-2"><a href="#构造方法-2" class="headerlink" title="构造方法"></a>构造方法</h4><ul>
<li>**Exchanger()**：创建一个新的 <code>Exchanger</code> 实例，用于交换指定类型的数据。</li>
</ul>
<h4 id="交换方法"><a href="#交换方法" class="headerlink" title="交换方法"></a>交换方法</h4><ul>
<li><strong>V exchange(V x) throws InterruptedException</strong>：在同步点等待另一个线程到达，并交换数据。该方法会阻塞直到另一个线程也调用 <code>exchange</code>。</li>
<li><strong>V exchange(V x, long timeout, TimeUnit unit) throws InterruptedException, TimeoutException</strong>：在指定的等待时间内等待另一个线程到达并交换数据。如果超时未交换成功，则抛出 <code>TimeoutException</code>。</li>
</ul>
<h4 id="其他方法-1"><a href="#其他方法-1" class="headerlink" title="其他方法"></a>其他方法</h4><ul>
<li>**int getParties()**：返回参与交换的线程数，通常为2。</li>
<li>**int getMaximumWaitTime()**：返回最大等待时间。</li>
</ul>
<h3 id="应用场景-3"><a href="#应用场景-3" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li><strong>生产者-消费者模型</strong>：两个线程在生产和消费数据时，可以使用 <code>Exchanger</code> 实现数据的高效交换。</li>
<li><strong>双缓冲技术</strong>：在需要两个缓冲区交替使用的场景，如图像处理、音视频流处理等，可以使用 <code>Exchanger</code> 实现缓冲区的交换。</li>
<li><strong>数据处理流水线</strong>：在多阶段的数据处理流水线中，两个相邻阶段的线程可以通过 <code>Exchanger</code> 进行数据交换。</li>
<li><strong>协同计算</strong>：两个线程需要在某些计算步骤上进行协同工作，并交换中间结果。</li>
</ul>
<h3 id="代码示例-3"><a href="#代码示例-3" class="headerlink" title="代码示例"></a>代码示例</h3><p>基本的双线程数据交换。</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExchangerExample</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// 创建一个 Exchanger，用于交换 String 类型的数据</span><br>        Exchanger&lt;String&gt; exchanger = <span class="hljs-keyword">new</span> Exchanger&lt;&gt;();<br><br>        <span class="hljs-comment">// 线程A</span><br>        Thread threadA = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            String data = <span class="hljs-string">&quot;数据A&quot;</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                log.info(<span class="hljs-string">&quot;线程A准备交换的数据: &quot;</span> + data);<br>                String receivedData = exchanger.exchange(data);<br>                log.info(<span class="hljs-string">&quot;线程A接收到的数据: &quot;</span> + receivedData);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                Thread.currentThread().interrupt();<br>                log.info(<span class="hljs-string">&quot;线程A被中断&quot;</span>);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;线程A&quot;</span>);<br><br>        <span class="hljs-comment">// 线程B</span><br>        Thread threadB = <span class="hljs-keyword">new</span> Thread(() -&gt; &#123;<br>            String data = <span class="hljs-string">&quot;数据B&quot;</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                log.info(<span class="hljs-string">&quot;线程B准备交换的数据: &quot;</span> + data);<br>                String receivedData = exchanger.exchange(data);<br>                log.info(<span class="hljs-string">&quot;线程B接收到的数据: &quot;</span> + receivedData);<br>            &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>                Thread.currentThread().interrupt();<br>                log.info(<span class="hljs-string">&quot;线程B被中断&quot;</span>);<br>            &#125;<br>        &#125;, <span class="hljs-string">&quot;线程B&quot;</span>);<br><br>        threadA.start();<br>        threadB.start();<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行程序，控制台输出如下</p>
<figure class="highlight stylus"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stylus"><span class="hljs-number">16</span>:<span class="hljs-number">01</span>:<span class="hljs-number">23.173</span> <span class="hljs-selector-attr">[线程A]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.ExchangerExample</span> - 线程A准备交换的数据: 数据A<br><span class="hljs-number">16</span>:<span class="hljs-number">01</span>:<span class="hljs-number">23.173</span> <span class="hljs-selector-attr">[线程B]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.ExchangerExample</span> - 线程B准备交换的数据: 数据B<br><span class="hljs-number">16</span>:<span class="hljs-number">01</span>:<span class="hljs-number">23.175</span> <span class="hljs-selector-attr">[线程A]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.ExchangerExample</span> - 线程A接收到的数据: 数据B<br><span class="hljs-number">16</span>:<span class="hljs-number">01</span>:<span class="hljs-number">23.175</span> <span class="hljs-selector-attr">[线程B]</span> INFO  space<span class="hljs-selector-class">.yangtao</span><span class="hljs-selector-class">.other</span><span class="hljs-selector-class">.ExchangerExample</span> - 线程B接收到的数据: 数据A<br></code></pre></div></td></tr></table></figure>

<h3 id="注意事项-3"><a href="#注意事项-3" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li><strong>仅适用于两个线程之间的数据交换</strong>：<code>Exchanger</code> 设计用于两个线程之间的数据交换，多于两个线程使用时会引发不可预测的行为。</li>
<li><strong>exchange 方法死锁风险</strong>：<code>exchange()</code> 方法会让当前线程阻塞，直到另一个线程到达并交换数据。如果配对线程未到达，则线程会一直阻塞，可能导致死锁。</li>
<li><strong>exchange 方法会被中断</strong>：如果线程在 <code>exchange()</code> 方法中被中断，会抛出 <code>InterruptedException</code>，导致交换失败。</li>
<li><strong>仅交换对象引用</strong>：<code>Exchanger</code> 仅交换对象的引用，而不会复制对象，确保交换的数据在多线程环境下的可变性可控，尤其是 <code>List</code>、<code>Map</code> 等可变对象，应特别注意并发修改问题。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在多线程协作的复杂场景中，使用合理的并发工具能大幅简化代码、减少错误风险：</p>
<ul>
<li><code>LockSupport</code> 以灵活的许可方式实现阻塞/唤醒，突破了传统 <code>wait/notify</code> 的局限，是众多并发组件的底层基石；</li>
<li><code>CyclicBarrier</code> 注重“多线程并发到达同一个关口”，适合分阶段执行的同步；</li>
<li><code>Phaser</code> 则是对 <code>Barrier</code> 的进一步扩展，支持可变线程数与更多交互方法，适合多阶段且参与者动态变化的场景；</li>
<li><code>Exchanger</code> 专注于“双线程交换数据”这一需求，让两条线程能够在同一同步点互相交换对象。</li>
</ul>
<p>通过充分了解它们各自的特性与适用情境，开发者能更从容地编写高质量多线程应用，既保证正确性，又在可维护性与性能之间取得最佳平衡。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">Java并发编程</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/JavaSE/">JavaSE</a>
                    
                      <a class="hover-with-bg" href="/tags/Java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">Java并发编程</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%B9%B6%E5%8F%91%E5%B7%A5%E5%85%B7%E7%B1%BB/">并发工具类</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/08/23/javase-cp-threadpool/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Java并发编程——线程池</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/17/javase-cp-cow/">
                        <span class="hidden-mobile">Java并发编程——Copy-On-Write</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'iyangtao/iyangtao.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <span>power by: </span> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span><u>Hexo</u></span></a> <span> - </span> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span><u>Fluid</u></span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>





  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize(null);
    }
  </script>




  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
