

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=light>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/MyInfo/%E5%A4%B4%E5%83%8F.jpg">
  <link rel="icon" href="/img/MyInfo/%E5%A4%B4%E5%83%8F.jpg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Yangtao">
  <meta name="keywords" content="">
  
    <meta name="description" content="Spring Cache是Spring Framework中提供的缓存抽象机制，它允许开发者通过注解或XML配置简化缓存的使用。Spring Cache支持多种缓存实现，包括Ehcache、Caffeine、Redis、Guava等。下面将对Spring Cache展开详细的介绍。">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Cache">
<meta property="og:url" content="http://example.com/2024/07/15/spring-cache/index.html">
<meta property="og:site_name" content="Yangtao&#39;s space">
<meta property="og:description" content="Spring Cache是Spring Framework中提供的缓存抽象机制，它允许开发者通过注解或XML配置简化缓存的使用。Spring Cache支持多种缓存实现，包括Ehcache、Caffeine、Redis、Guava等。下面将对Spring Cache展开详细的介绍。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://picgo-1304850123.cos.ap-guangzhou.myqcloud.com/spring-cache.webp">
<meta property="article:published_time" content="2024-07-15T14:58:37.000Z">
<meta property="article:modified_time" content="2024-07-15T14:58:37.000Z">
<meta property="article:author" content="Yangtao">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="缓存">
<meta property="article:tag" content="性能">
<meta property="article:tag" content="Spring Cache">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://picgo-1304850123.cos.ap-guangzhou.myqcloud.com/spring-cache.webp">
  
  
  <title>Spring Cache - Yangtao&#39;s space</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":50,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":false,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Programmer Yangtao</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                作者
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('https://picgo-1304850123.cos.ap-guangzhou.myqcloud.com/spring-cache.webp') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="Spring Cache">
              
            </span>

            
              <div class="mt-3">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-author" aria-hidden="true"></i>
      Yangtao
    </span>
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2024-07-15 22:58" pubdate>
        2024年7月15日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      38k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      65 分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">Spring Cache</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：1 年前
                
              </p>
            
            <div class="markdown-body">
              <p><code>Spring Cache</code>是<code>Spring Framework</code>中提供的缓存抽象机制，它允许开发者通过注解或<code>XML</code>配置简化缓存的使用。<code>Spring Cache</code>支持多种缓存实现，包括<code>Ehcache</code>、<code>Caffeine</code>、<code>Redis</code>、<code>Guava</code>等。下面将对<code>Spring Cache</code>展开详细的介绍。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           </p>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><h3 id="为什么使用缓存"><a href="#为什么使用缓存" class="headerlink" title="为什么使用缓存"></a>为什么使用缓存</h3><ol>
<li><strong>性能提升</strong>：缓存主要用于减少重复的数据处理和数据检索操作，特别是减少对数据库的直接访问，从而加快数据的访问速度，提高应用程序的响应性能。</li>
<li><strong>减少成本</strong>：通过减少对后端系统如数据库的请求，缓存可以帮助降低运营成本。尤其是在高流量的应用中，适当的缓存策略可以显著减少需要的资源和相关的成本。</li>
<li><strong>提高可伸缩性</strong>：缓存可以帮助应对高并发场景，通过缓存常用数据来避免在高流量下数据库成为瓶颈。</li>
</ol>
<h3 id="Java-缓存管理痛点"><a href="#Java-缓存管理痛点" class="headerlink" title="Java 缓存管理痛点"></a>Java 缓存管理痛点</h3><ol>
<li><strong>缺乏统一标准</strong>：在<code>Spring Cache</code>出现之前，Java应用通常需要依赖于具体的缓存实现（如<code>Ehcache</code>、<code>Guava Cache</code>等）或自定义解决方案。这些实现各自有自己的API和配置方式，缺乏统一标准，使得在不同项目或组件间共享缓存逻辑变得复杂。</li>
<li><strong>集成复杂性</strong>：不同的缓存解决方案需要不同的集成策略，对开发者来说，这意味着需要对每一种技术都有深入的理解。这种复杂性增加了开发和维护的难度，也提高了学习成本。</li>
<li><strong>功能局限</strong>：许多早期的缓存库专注于缓存数据，但缺乏高级功能，如声明式的缓存操作、自动的缓存刷新和条件缓存等。</li>
</ol>
<h3 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h3><p>为了解决Java缓存管理中存在的多种问题，提供一个简单、统一且功能强大的缓存管理解决方案，以适应现代应用对性能和可伸缩性的高要求，<code>Spring Cache</code>诞生了，带来的改变包括：</p>
<ol>
<li><strong>统一的抽象层</strong>：<code>Spring Cache</code>提供了一个清晰的缓存抽象层，使得开发者可以不关心具体的缓存实现细节，统一使用缓存注解来控制缓存行为。</li>
<li><strong>简化配置和使用</strong>：通过<code>Spring</code>的配置和注解支持，开发者可以很容易地配置和使用缓存，而无需编写大量的模板代码。这降低了使用缓存的门槛，提高了开发效率。</li>
<li><strong>灵活性和扩展性</strong>：<code>Spring Cache</code>不仅支持多种流行的缓存技术，还允许通过自定义 <code>CacheManager</code> 来扩展新的缓存实现，提供了极大的灵活性。</li>
<li><strong>与Spring生态系统的整合</strong>：<code>Spring Cache</code>的引入使得缓存策略能够更好地与<code>Spring</code>的其他项目（如 <code>Spring Data</code>、<code>Spring Security</code>）整合，提供一致的开发体验。</li>
</ol>
<h2 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h2><h3 id="缓存抽象"><a href="#缓存抽象" class="headerlink" title="缓存抽象"></a>缓存抽象</h3><p><code>Spring Cache</code>通过一组接口来定义缓存的操作，主要包括存储、获取、更新和清除缓存数据。这种抽象层让开发者可以不用关心具体的缓存实现细节，比如使用内存缓存、文件缓存或是分布式缓存系统。</p>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p><code>Spring Cache</code>提供以下几种注解来简化缓存操作的实现：</p>
<ul>
<li>**<code>@Cacheable</code>**：最常用的注解，用于表示某个方法的返回值是可缓存的。如果缓存中已有相应的值，则方法不会执行，直接从缓存返回数据。</li>
<li>**<code>@CacheEvict</code>**：用于清除缓存数据，支持在方法执行前或执行后清除。</li>
<li>**<code>@CachePut</code>**：总是会执行方法，并将结果放入指定的缓存。这常用于更新缓存数据。</li>
<li>**<code>@Caching</code>**：复合注解，可以同时应用多个其他缓存注解。</li>
</ul>
<h3 id="缓存解析和存储"><a href="#缓存解析和存储" class="headerlink" title="缓存解析和存储"></a>缓存解析和存储</h3><p><code>Spring Cache</code>的工作方式是拦截基于注解的方法调用，根据方法的参数和注解的配置决定如何缓存方法的返回值或如何操作缓存。</p>
<h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><h3 id="方法拦截"><a href="#方法拦截" class="headerlink" title="方法拦截"></a>方法拦截</h3><ul>
<li><code>Spring</code>使用代理模式或<code>AOP</code>拦截那些被<code>@Cacheable</code>、<code>@CacheEvict</code>等注解标记的方法。</li>
<li>当调用这些方法时，<code>Spring Cache</code>的拦截器会介入处理。</li>
</ul>
<h3 id="缓存键生成"><a href="#缓存键生成" class="headerlink" title="缓存键生成"></a>缓存键生成</h3><ul>
<li>默认情况下，<code>Spring Cache</code>使用方法的参数生成缓存键。开发者可以通过表达式自定义键值的生成策略。</li>
<li>对于 <code>@Cacheable</code> 和 <code>@CachePut</code> 注解，如果缓存中存在相应的键，则可以直接返回缓存中的数据或更新数据。</li>
</ul>
<h3 id="缓存命中"><a href="#缓存命中" class="headerlink" title="缓存命中"></a>缓存命中</h3><ul>
<li>当缓存命中时，即缓存中已存在对应的键值，对于<code>@Cacheable</code>注解的方法，直接从缓存返回数据，不执行方法体。</li>
<li>对于<code>@CachePut</code>注解，方法体将被执行，且新的返回值将替换缓存中的旧值。</li>
</ul>
<h3 id="缓存更新和失效"><a href="#缓存更新和失效" class="headerlink" title="缓存更新和失效"></a>缓存更新和失效</h3><ul>
<li><code>@CacheEvict</code>可以用来在适当的时候清除缓存，保持缓存数据的新鲜度。可以配置为方法执行前或执行后清除缓存。</li>
<li><code>@CachePut</code>用于更新缓存中的数据，确保缓存的数据是最新的。</li>
</ul>
<h3 id="缓存管理"><a href="#缓存管理" class="headerlink" title="缓存管理"></a>缓存管理</h3><ul>
<li><code>Spring</code>提供了<code>CacheManager</code>接口来管理不同的缓存库。每个缓存库可以配置不同的存储和过期策略。</li>
</ul>
<h2 id="实现方案"><a href="#实现方案" class="headerlink" title="实现方案"></a>实现方案</h2><p>创建一个基础的<code>SpringBoot</code>项目，添加<code>spring-boot-starter-cache</code>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure>

<p>启动类中添加<code>@EnableCaching</code>注解</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableCaching</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpringcacheApplication</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(SpringcacheApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="EHCache"><a href="#EHCache" class="headerlink" title="EHCache"></a>EHCache</h3><p><code>EHCache</code>是一种广泛使用的开源Java缓存库，适用于提升应用程序的性能，通过减少数据库访问、提供快速的访问速度来减轻后端系统的负载。</p>
<p><strong>概念</strong></p>
<ol>
<li><p><strong>内存和磁盘存储</strong>：</p>
<ul>
<li><p><code>EHCache</code>提供内存和磁盘两层存储机制，可以配置为仅内存、内存加磁盘持久化或仅磁盘存储。</p>
</li>
<li><p>内存存储提供快速访问，而磁盘存储则支持更大的缓存容量和重启后的数据恢复。</p>
</li>
</ul>
</li>
<li><p><strong>数据元素</strong>：</p>
<ul>
<li>在<code>EHCache</code>中，每个缓存条目称为一个元素（<code>Element</code>），每个元素有一个键（<code>Key</code>）和一个值（<code>Value</code>）。</li>
</ul>
</li>
<li><p><strong>缓存淘汰机制</strong>：</p>
<ul>
<li>支持多种缓存淘汰策略，包括最少使用（<code>LRU</code>）、最少访问（<code>LFU</code>）和先进先出（<code>FIFO</code>）。</li>
</ul>
</li>
</ol>
<p><strong>实现</strong></p>
<ol>
<li><p><code>SpringBoot</code>配置文件中设置<code>SpringCache</code>的类型设置为<code>ehcache</code></p>
<figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.cache.type</span>=<span class="hljs-string">ehcache</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>添加Maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.sf.ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>ehcache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.10.9.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>在资源目录下创建<code>ehcache.xml</code>配置文件，定义缓存的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">ehcache</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- 配置磁盘存储的路径 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">diskStore</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;java.io.tmpdir&quot;</span>/&gt;</span><br><br>    <span class="hljs-comment">&lt;!--</span><br><span class="hljs-comment">        1. maxElementsInMemory: 内存中缓存的最大条目数</span><br><span class="hljs-comment">        2. eternal: 是否永不过期</span><br><span class="hljs-comment">        3. timeToIdleSeconds: 元素在缓存中可以处于空闲状态的最大时间（秒），超过此时间未被访问的元素将被淘汰</span><br><span class="hljs-comment">        4. timeToLiveSeconds: 元素在缓存中可以存活的最大时间（秒），从元素被存入缓存开始计算</span><br><span class="hljs-comment">        5. overflowToDisk: 是否允许溢出到磁盘</span><br><span class="hljs-comment">        6. diskPersistent: 是否磁盘持久化</span><br><span class="hljs-comment">        7. diskExpiryThreadIntervalSeconds: 磁盘过期检查线程运行间隔（秒）</span><br><span class="hljs-comment">        8. memoryStoreEvictionPolicy: 内存存储淘汰策略（LRU最近最少使用、LFU最不频繁使用、FIFO先进先出）</span><br><span class="hljs-comment">     --&gt;</span><br>    <br>    <span class="hljs-comment">&lt;!-- 默认的缓存配置 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">defaultCache</span></span><br><span class="hljs-tag">            <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">&quot;1000&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">eternal</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">&quot;300&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">&quot;600&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">diskPersistent</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">diskExpiryThreadIntervalSeconds</span>=<span class="hljs-string">&quot;120&quot;</span></span><br><span class="hljs-tag">            <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">&quot;LRU&quot;</span></span><br><span class="hljs-tag">    /&gt;</span><br><br>    <span class="hljs-comment">&lt;!-- 定义名为 codeCache 的缓存 --&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">cache</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;codeCache&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">maxElementsInMemory</span>=<span class="hljs-string">&quot;1000&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">eternal</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">timeToIdleSeconds</span>=<span class="hljs-string">&quot;300&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">timeToLiveSeconds</span>=<span class="hljs-string">&quot;600&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">overflowToDisk</span>=<span class="hljs-string">&quot;true&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">diskPersistent</span>=<span class="hljs-string">&quot;false&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">diskExpiryThreadIntervalSeconds</span>=<span class="hljs-string">&quot;120&quot;</span></span><br><span class="hljs-tag">           <span class="hljs-attr">memoryStoreEvictionPolicy</span>=<span class="hljs-string">&quot;LRU&quot;</span></span><br><span class="hljs-tag">    /&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">ehcache</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>新增配置类<code>EhCacheConfig</code>，读取配置文件<code>ehcache.xml</code>中的配置</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EhCacheConfig</span> </span>&#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CacheManager <span class="hljs-title">cacheManager</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException </span>&#123;<br>        net.sf.ehcache.CacheManager ehCacheManager =<br>                <span class="hljs-keyword">new</span> net.sf.ehcache.CacheManager(<span class="hljs-keyword">new</span> ClassPathResource(<span class="hljs-string">&quot;ehcache.xml&quot;</span>).getInputStream());<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> EhCacheCacheManager(ehCacheManager);<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>本次用于测试的<code>CodeService</code>，含有属性<code>codeMap</code>，以及对应的增删改查方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CodeService</span> </span>&#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(CodeService.class);<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Integer, String&gt; codeMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();<br><br>    <span class="hljs-meta">@Cacheable(value = &quot;codeCache&quot;, keyGenerator = &quot;customCacheKeyGenerator&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getCode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        logger.info(<span class="hljs-string">&quot;getCode开始执行，id: &#123;&#125;&quot;</span>, id);<br>        <span class="hljs-keyword">return</span> codeMap.get(id);<br>    &#125;<br><br>    <span class="hljs-meta">@CachePut(value = &quot;codeCache&quot;, keyGenerator = &quot;customCacheKeyGenerator&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addOrUpdateCode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id, String description)</span> </span>&#123;<br>        logger.info(<span class="hljs-string">&quot;addOrUpdateCode开始执行，id: &#123;&#125;，description: &#123;&#125;&quot;</span>, id, description);<br>        codeMap.put(id, description);<br>        <span class="hljs-keyword">return</span> description;<br>    &#125;<br><br>    <span class="hljs-meta">@CacheEvict(value = &quot;codeCache&quot;, keyGenerator = &quot;customCacheKeyGenerator&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteCode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>        logger.info(<span class="hljs-string">&quot;deleteCode开始执行，id: &#123;&#125;&quot;</span>, id);<br>        codeMap.remove(id);<br>    &#125;<br><br>    <span class="hljs-meta">@CacheEvict(value = &quot;codeCache&quot;, allEntries = true)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">clearCache</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// 这里不需要操作codeMap，@CacheEvict注解已经处理了缓存清空</span><br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>因为缓存是存在于内存或磁盘中的，为了避免缓存的键重复，可以在<code>Spring Cache</code>的注解中自定义键的生成策略，如以方法参数<code>id</code>为键</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(value = &quot;codeCache&quot;, key = &quot;#id&quot;)</span><br></code></pre></div></td></tr></table></figure>

<p>还可以通过实现<code>KeyGenerator</code>接口，对这个生成策略进行自定义、动态地生成键，且这种方式也能支持复用。例如创建一个<code>CustomCacheKeyGenerator</code>，生成策略为<code>simpleName::params[0]</code></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Component(&quot;customCacheKeyGenerator&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomCacheKeyGenerator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">KeyGenerator</span> </span>&#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">generate</span><span class="hljs-params">(Object target, Method method, Object... params)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> target.getClass().getSimpleName() + <span class="hljs-string">&quot;::&quot;</span> + params[<span class="hljs-number">0</span>];<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p><code>Spring Cache</code>注解中指定使用刚才自定义的<code>CustomCacheKeyGenerator</code></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(value = &quot;codeCache&quot;, keyGenerator = &quot;customCacheKeyGenerator&quot;)</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>将<code>Spring Cache</code>的日志级别更改为<code>trace</code>，以便观察日志信息</p>
<figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">logging.level.org.springframework.cache</span>=<span class="hljs-string">trace</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>单元测试如下</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">codeServiceTest1</span><span class="hljs-params">()</span> </span>&#123;<br>    logger.info(<span class="hljs-string">&quot;初始化数据，调用addOrUpdateCode方法，设置id=1的值为one&quot;</span>);<br>    codeService.addOrUpdateCode(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;one&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;初始化后第一次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;初始化后第二次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;调用deleteCode方法&quot;</span>);<br>    codeService.deleteCode(<span class="hljs-number">1</span>);<br>    logger.info(<span class="hljs-string">&quot;deleteCode后第一次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;deleteCode后第二次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;第一次调用id=2的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">2</span>));<br>    logger.info(<span class="hljs-string">&quot;第二次调用id=2的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">2</span>));<br>    logger.info(<span class="hljs-string">&quot;调用clearCache方法&quot;</span>);<br>    codeService.clearCache();<br>    logger.info(<span class="hljs-string">&quot;clearCache后第一次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;clearCache后第一次调用id=2的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">2</span>));<br>    logger.info(<span class="hljs-string">&quot;调用addOrUpdateCode方法，设置id=1的值为one&quot;</span>);<br>    codeService.addOrUpdateCode(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;one&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>控制台输出日志如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">2024-07-15 00:41:05.629  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 初始化数据，调用addOrUpdateCode方法，设置id=1的值为one<br>2024-07-15 00:41:05.637  INFO 39528 --- [           main] s.y.springcache.service.CodeService      : addOrUpdateCode开始执行，id: 1，description: one<br>2024-07-15 00:41:05.638 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.addOrUpdateCode(int,java.lang.String)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span><br>2024-07-15 00:41:05.641 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.642 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:41:05.642  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 初始化后第一次调用id=1的getCode方法：one<br>2024-07-15 00:41:05.642 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.642 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:41:05.642  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 初始化后第二次调用id=1的getCode方法：one<br>2024-07-15 00:41:05.642  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 调用deleteCode方法<br>2024-07-15 00:41:05.642  INFO 39528 --- [           main] s.y.springcache.service.CodeService      : deleteCode开始执行，id: 1<br>2024-07-15 00:41:05.642 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public void space.yangtao.springcache.service.CodeService.deleteCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span><br>2024-07-15 00:41:05.642 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Invalidating cache key [CodeService::1] <span class="hljs-keyword">for</span> operation Builder[public void space.yangtao.springcache.service.CodeService.deleteCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span> on method public void space.yangtao.springcache.service.CodeService.deleteCode(int)<br>2024-07-15 00:41:05.642 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.644  INFO 39528 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 1<br>2024-07-15 00:41:05.644  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : deleteCode后第一次调用id=1的getCode方法：null<br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:41:05.644  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : deleteCode后第二次调用id=1的getCode方法：null<br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.644  INFO 39528 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 2<br>2024-07-15 00:41:05.644  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 第一次调用id=2的getCode方法：null<br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.644 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:41:05.644  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 第二次调用id=2的getCode方法：null<br>2024-07-15 00:41:05.645  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 调用clearCache方法<br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Invalidating entire cache <span class="hljs-keyword">for</span> operation Builder[public void space.yangtao.springcache.service.CodeService.clearCache()] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-literal">true</span>,<span class="hljs-literal">false</span> on method public void space.yangtao.springcache.service.CodeService.clearCache()<br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.645  INFO 39528 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 1<br>2024-07-15 00:41:05.645  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : clearCache后第一次调用id=1的getCode方法：null<br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:41:05.645  INFO 39528 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 2<br>2024-07-15 00:41:05.645  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : clearCache后第一次调用id=2的getCode方法：null<br>2024-07-15 00:41:05.645  INFO 39528 --- [           main] s.y.s.SpringcacheApplicationTests        : 调用addOrUpdateCode方法，设置id=1的值为one<br>2024-07-15 00:41:05.645  INFO 39528 --- [           main] s.y.springcache.service.CodeService      : addOrUpdateCode开始执行，id: 1，description: one<br>2024-07-15 00:41:05.645 TRACE 39528 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.addOrUpdateCode(int,java.lang.String)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span><br></code></pre></div></td></tr></table></figure>

<p>分析：</p>
<ol>
<li>初始化数据，调用<code>addOrUpdateCode</code>方法，设置<code>id=1</code>的数据，并存入一个<code>key</code>为<code>CodeService::1</code>的缓存</li>
<li>初始化后的第一二次调用<code>getCode</code>，都从缓存中取到了<code>CodeService::1</code>的数据</li>
<li>调用<code>deleteCode</code>方法，这个方法会将缓存<code>CodeService::1</code>失效</li>
<li><code>deleteCode</code>后调用<code>getCode</code>方法，这次没有获取到<code>CodeService::1</code>的缓存，因此执行了<code>getCode</code>方法，并将结果缓存了起来</li>
<li><code>deleteCode</code>后第二次调用<code>getCode</code>方法取到了上一次<code>getCode</code>方法设置的缓存</li>
<li>第一次调用<code>getCode（id=2）</code>的方法，没有<code>CodeService::2</code>，因此执行了<code>getCode</code>方法并设置了对应的缓存，第二次调用的时候这个缓存被获取到</li>
<li>手动调用<code>clearCache</code>方法，清除了所有的缓存，之后调用<code>getCode</code>方法，<code>id=1</code>或<code>id=2</code>都无法获取到对应的缓存<code>CodeService::1</code>或<code>CodeService::2</code></li>
<li>调用<code>addOrUpdateCode</code>方法，重新设置<code>id=1</code>的数据并重新设置缓存</li>
</ol>
</li>
</ol>
<p>上述<code>EhCache</code>的缓存，都是在内存或磁盘级别，这就带来了一个问题，在多实例的情况下，同一个方法同一个参数的多次调用可能使用不了缓存</p>
<p>编写第二个测试方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">codeServiceTest2</span><span class="hljs-params">()</span> </span>&#123;<br>    logger.info(<span class="hljs-string">&quot;实例2开始测试------------------------------------&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;第二个实例调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行结果如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">2024-07-15 00:43:12.122  INFO 37712 --- [           main] s.y.s.SpringcacheApplicationTests        : 实例2开始测试------------------------------------<br>2024-07-15 00:43:12.124 TRACE 37712 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:43:12.125 TRACE 37712 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:43:12.125 TRACE 37712 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:43:12.130  INFO 37712 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 1<br>2024-07-15 00:43:12.132  INFO 37712 --- [           main] s.y.s.SpringcacheApplicationTests        : 第二个实例调用id=1的getCode方法：null<br></code></pre></div></td></tr></table></figure>

<p>分析：运行第二次的测试方法，发现获取不到上次单元测试中最后设置的缓存<code>CodeService::1</code>，原因是因为之前的单元测试实例停止了，内存中找不到缓存，因此需要引入分布式缓存。分布式缓存支持跨多个实例共享缓存数据，常见的解决方法有<code>Redis</code>或<code>Memcached</code>。</p>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><p><code>Redis</code>提供了高性能的数据结构服务，非常适合用作分布式缓存系统。需要注意的是，<code>Redis</code>作为一个独立的内存数据结构服务器，作为<code>Spring Cache</code>的后端时，配置选项与使用内存或本地缓存系统时有所不同，通常只配置过期时间<code>TTL</code>以及序列化方式，而其余参数（如最大使用内存、持久化、淘汰策略等）则由<code>Redis</code>服务器单独配置。</p>
<p><strong>实现</strong></p>
<ol>
<li><p><code>SpringBoot</code>配置文件中设置<code>Spring Cache</code>的类型设置为<code>Redis</code>、并配置<code>Redis</code>的连接信息</p>
<figure class="highlight properties"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs properties"><span class="hljs-meta">spring.cache.type</span>=<span class="hljs-string">redis</span><br><br><span class="hljs-meta">spring.redis.host</span>=<span class="hljs-string">localhost</span><br><span class="hljs-meta">spring.redis.port</span>=<span class="hljs-string">6379</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>引入Maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>配置类<code>RedisCacheConfig</code></p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisCacheConfig</span> </span>&#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> CacheManager <span class="hljs-title">cacheManager</span><span class="hljs-params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;<br>        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()<br>                <span class="hljs-comment">// 设置缓存过期时间为10分钟</span><br>                .entryTtl(Duration.ofMinutes(<span class="hljs-number">10</span>))<br>                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="hljs-keyword">new</span> StringRedisSerializer()))<br>                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(<span class="hljs-keyword">new</span> GenericJackson2JsonRedisSerializer()))<br>                <span class="hljs-comment">// 不缓存空值</span><br>                .disableCachingNullValues();<br><br>        <span class="hljs-keyword">return</span> RedisCacheManager.builder(redisConnectionFactory)<br>                .cacheDefaults(config)<br>                .build();<br>    &#125;<br><br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>其他的配置（如缓存<code>key</code>的生成类以及<code>service</code>方法中注解的使用）与<code>EhCache</code>中配置一致，保持不变</p>
</li>
<li><p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">codeServiceTest1</span><span class="hljs-params">()</span> </span>&#123;<br>    logger.info(<span class="hljs-string">&quot;初始化数据，调用addOrUpdateCode方法，设置id=1的值为one&quot;</span>);<br>    codeService.addOrUpdateCode(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;one&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;初始化后第一次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;初始化后第二次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;调用deleteCode方法&quot;</span>);<br>    codeService.deleteCode(<span class="hljs-number">1</span>);<br>    logger.info(<span class="hljs-string">&quot;deleteCode后第一次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;deleteCode后第二次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;第一次调用id=2的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">2</span>));<br>    logger.info(<span class="hljs-string">&quot;第二次调用id=2的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">2</span>));<br>    logger.info(<span class="hljs-string">&quot;调用clearCache方法&quot;</span>);<br>    codeService.clearCache();<br>    logger.info(<span class="hljs-string">&quot;clearCache后第一次调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>    logger.info(<span class="hljs-string">&quot;clearCache后第一次调用id=2的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">2</span>));<br>    logger.info(<span class="hljs-string">&quot;调用addOrUpdateCode方法，设置id=1的值为one&quot;</span>);<br>    codeService.addOrUpdateCode(<span class="hljs-number">1</span>, <span class="hljs-string">&quot;one&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">2024-07-15 00:54:45.618  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 初始化数据，调用addOrUpdateCode方法，设置id=1的值为one<br>2024-07-15 00:54:45.630  INFO 27052 --- [           main] s.y.springcache.service.CodeService      : addOrUpdateCode开始执行，id: 1，description: one<br>2024-07-15 00:54:45.632 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.addOrUpdateCode(int,java.lang.String)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span><br>2024-07-15 00:54:46.193 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.200 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:54:46.200  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 初始化后第一次调用id=1的getCode方法：one<br>2024-07-15 00:54:46.200 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.201 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:54:46.201  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 初始化后第二次调用id=1的getCode方法：one<br>2024-07-15 00:54:46.201  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 调用deleteCode方法<br>2024-07-15 00:54:46.201  INFO 27052 --- [           main] s.y.springcache.service.CodeService      : deleteCode开始执行，id: 1<br>2024-07-15 00:54:46.201 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public void space.yangtao.springcache.service.CodeService.deleteCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span><br>2024-07-15 00:54:46.201 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Invalidating cache key [CodeService::1] <span class="hljs-keyword">for</span> operation Builder[public void space.yangtao.springcache.service.CodeService.deleteCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-literal">false</span>,<span class="hljs-literal">false</span> on method public void space.yangtao.springcache.service.CodeService.deleteCode(int)<br>2024-07-15 00:54:46.204 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.205 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:54:46.206 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.206  INFO 27052 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 1<br>2024-07-15 00:54:46.206  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : deleteCode后第一次调用id=1的getCode方法：null<br>2024-07-15 00:54:46.207 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.207 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:54:46.207  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : deleteCode后第二次调用id=1的getCode方法：null<br>2024-07-15 00:54:46.207 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.208 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:54:46.208 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.208  INFO 27052 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 2<br>2024-07-15 00:54:46.208  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 第一次调用id=2的getCode方法：null<br>2024-07-15 00:54:46.208 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.208 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:54:46.208  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 第二次调用id=2的getCode方法：null<br>2024-07-15 00:54:46.208  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 调用clearCache方法<br>2024-07-15 00:54:46.210 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Invalidating entire cache <span class="hljs-keyword">for</span> operation Builder[public void space.yangtao.springcache.service.CodeService.clearCache()] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-literal">true</span>,<span class="hljs-literal">false</span> on method public void space.yangtao.springcache.service.CodeService.clearCache()<br>2024-07-15 00:54:46.213 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.215 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:54:46.215 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.215  INFO 27052 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 1<br>2024-07-15 00:54:46.215  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : clearCache后第一次调用id=1的getCode方法：null<br>2024-07-15 00:54:46.215 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.216 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : No cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">in</span> cache(s) [codeCache]<br>2024-07-15 00:54:46.216 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::2&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:54:46.216  INFO 27052 --- [           main] s.y.springcache.service.CodeService      : getCode开始执行，id: 2<br>2024-07-15 00:54:46.216  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : clearCache后第一次调用id=2的getCode方法：null<br>2024-07-15 00:54:46.216  INFO 27052 --- [           main] s.y.s.SpringcacheApplicationTests        : 调用addOrUpdateCode方法，设置id=1的值为one<br>2024-07-15 00:54:46.216  INFO 27052 --- [           main] s.y.springcache.service.CodeService      : addOrUpdateCode开始执行，id: 1，description: one<br>2024-07-15 00:54:46.217 TRACE 27052 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.addOrUpdateCode(int,java.lang.String)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span><br></code></pre></div></td></tr></table></figure></li>
<li><p>可以发现与之前<code>EhCache</code>使用内存作为缓存方案的测试结果并没有什么差别，这就说明了<code>Spring Cache</code>提供的缓存抽象层使得开发者可以不关心具体的缓存实现细节</p>
</li>
<li><p>此时再运行第二个方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">codeServiceTest2</span><span class="hljs-params">()</span> </span>&#123;<br>    logger.info(<span class="hljs-string">&quot;实例2开始测试------------------------------------&quot;</span>);<br>    logger.info(<span class="hljs-string">&quot;第二个实例调用id=1的getCode方法：&#123;&#125;&quot;</span>, codeService.getCode(<span class="hljs-number">1</span>));<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p>运行结果如下</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">2024-07-15 00:55:49.319  INFO 30368 --- [           main] s.y.s.SpringcacheApplicationTests        : 实例2开始测试------------------------------------<br>2024-07-15 00:55:49.324 TRACE 30368 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Computed cache key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> <span class="hljs-keyword">for</span> operation Builder[public java.lang.String space.yangtao.springcache.service.CodeService.getCode(int)] caches=[codeCache] | key=<span class="hljs-string">&#x27;&#x27;</span> | keyGenerator=<span class="hljs-string">&#x27;customCacheKeyGenerator&#x27;</span> | cacheManager=<span class="hljs-string">&#x27;&#x27;</span> | cacheResolver=<span class="hljs-string">&#x27;&#x27;</span> | condition=<span class="hljs-string">&#x27;&#x27;</span> | unless=<span class="hljs-string">&#x27;&#x27;</span> | sync=<span class="hljs-string">&#x27;false&#x27;</span><br>2024-07-15 00:55:49.910 TRACE 30368 --- [           main] o.s.cache.interceptor.CacheInterceptor   : Cache entry <span class="hljs-keyword">for</span> key <span class="hljs-string">&#x27;CodeService::1&#x27;</span> found <span class="hljs-keyword">in</span> cache <span class="hljs-string">&#x27;codeCache&#x27;</span><br>2024-07-15 00:55:49.910  INFO 30368 --- [           main] s.y.s.SpringcacheApplicationTests        : 第二个实例调用id=1的getCode方法：one<br></code></pre></div></td></tr></table></figure>

<p>可以发现这次使用分布式缓存以后，第二次测试也可以获取到之前的缓存<code>CodeService::1</code>，因为这个缓存是存在于<code>Redis</code>数据库中的，查看数据库也可以验证这一点，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">127.0.0.1:6379&gt; keys *<br>1) <span class="hljs-string">&quot;codeCache::CodeService::2&quot;</span><br>2) <span class="hljs-string">&quot;codeCache::CodeService::1&quot;</span><br>127.0.0.1:6379&gt; get codeCache::CodeService::1<br><span class="hljs-string">&quot;\xac\xed\x00\x05t\x00\x03one&quot;</span><br></code></pre></div></td></tr></table></figure></li>
</ol>
<h2 id="注解补充说明"><a href="#注解补充说明" class="headerlink" title="注解补充说明"></a>注解补充说明</h2><h3 id="注解-1"><a href="#注解-1" class="headerlink" title="注解"></a>注解</h3><p><code>@Caching</code>注解可以组合多个缓存注解，使得在一个方法上可以同时应用<code>@Cacheable</code>、<code>@CachePut</code>和<code>@CacheEvict</code>注解。这对于需要对一个方法进行多重缓存逻辑处理的情况非常有用。</p>
<p>示例：在更新代码时同时更新缓存并在特定条件下删除另一个缓存条目</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Caching(</span><br><span class="hljs-meta">    put = &#123; @CachePut(value = &quot;codeCache&quot;, key = &quot;#id&quot;) &#125;,</span><br><span class="hljs-meta">    evict = &#123; @CacheEvict(value = &quot;otherCache&quot;, key = &quot;#id&quot;, condition = &quot;#id &gt; 10&quot;) &#125;</span><br><span class="hljs-meta">)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">addOrUpdateCode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id, String description)</span> </span>&#123;<br>    ...<br>&#125;<br></code></pre></div></td></tr></table></figure>

<p><code>@Caching</code>提供了组合多种缓存操作的能力，在复杂的缓存逻辑中非常有用，但对于简单的缓存需求，使用<code>@Caching</code>可能反而会引入不必要的复杂性。</p>
<h3 id="注解属性"><a href="#注解属性" class="headerlink" title="注解属性"></a>注解属性</h3><ul>
<li><code>value/cacheNames</code>：指定缓存操作的缓存名称。至少需要指定一个缓存名称，因为缓存的目标是根据名称进行存储和检索。示例：<code>@Cacheable(value = &quot;myCache&quot;)</code></li>
<li><code>key</code>：使用<code>Spring Expression Language (SpEL)</code>表达式指定缓存的键。如果不指定，则默认使用所有的方法参数组合作为键。示例：<code>@Cacheable(value = &quot;myCache&quot;, key = &quot;#id&quot;)</code></li>
<li><code>keyGenerator</code>：指定用来生成缓存键的自定义 <code>KeyGenerator</code> bean 的名称。如果设置了这个属性，那么 <code>key</code> 属性应当忽略。示例：<code>@Cacheable(value = &quot;myCache&quot;, keyGenerator = &quot;myCustomKeyGenerator&quot;)</code></li>
<li><code>cacheManager</code>：指定用来管理缓存操作的<code>CacheManager</code> bean的名称。只在你配置了多个 <code>CacheManager</code> 的情况下需要使用。示例：<code>@Cacheable(value = &quot;myCache&quot;, cacheManager = &quot;myCacheManager&quot;)</code></li>
<li><code>cacheResolver</code>：指定用来解析使用哪个缓存的<code>CacheResolver</code> bean的名称。如果设置了这个属性，<code>cacheManager</code>属性应当忽略。示例：<code>@Cacheable(value = &quot;myCache&quot;, cacheResolver = &quot;myCacheResolver&quot;)</code></li>
<li><code>condition</code>：一个<code>SpEL</code>表达式，当表达式为true时，方法返回值会被缓存。这可以用来在某些条件下才缓存结果。示例：<code>@Cacheable(value = &quot;myCache&quot;, condition = &quot;#id &gt; 10&quot;)</code></li>
<li><code>unless</code>：一个<code>SpEL</code>表达式，当表达式为true时，即使方法被缓存拦截，返回值也不会被放入缓存。这通常用于防止将不想缓存的数据放入缓存。示例：<code>@Cacheable(value = &quot;myCache&quot;, unless = &quot;#result == null&quot;)</code></li>
<li><code>sync</code>：指定是否使用同步模式。如果多个线程同时访问一个计算量大的缓存方法，只有一个线程将执行方法，其他线程将等待这个结果被计算出来，避免多次执行相同的方法。示例：<code>@Cacheable(value = &quot;myCache&quot;, sync = true)</code></li>
<li><code>allEntries</code>：指定是否需要从缓存中移除所有条目。设置为<code>true</code>时，不考虑<code>key</code>属性的设置，将清空整个缓存。示例：<code>@CacheEvict(value = &quot;myCache&quot;, allEntries = true)</code></li>
<li><code>beforeInvocation</code>：指定缓存清除操作是在方法执行之前还是之后进行，默认情况下为false，即方法执行结束前不清除缓存，常用于可能抛出异常的方法（先清除缓存再执行方法，确保无论数据操作成功与否，缓存都不会返回旧数据）。示例：<code>@CacheEvict(value = &quot;myCache&quot;, beforeInvocation = true)</code></li>
</ul>
<h2 id="缓存管理-1"><a href="#缓存管理-1" class="headerlink" title="缓存管理"></a>缓存管理</h2><h3 id="cacheManager"><a href="#cacheManager" class="headerlink" title="cacheManager"></a>cacheManager</h3><p><strong>定义</strong>：<code>cacheManager</code>属性用于指定管理缓存的<code>CacheManager</code>实例。在Spring应用中，<code>CacheManager</code>负责创建和维护缓存实例。</p>
<p><strong>用途</strong>：当应用配置了多个<code>CacheManager</code>时，可以通过<code>cacheManager</code>属性明确指定某个方法或类使用哪一个<code>CacheManager</code>。这是通常在有多种缓存存储（如内存、Redis、EhCache等）时需要考虑的情况。</p>
<p><strong>示例</strong>：使用<code>cacheManager</code>属性指定缓存管理器。</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(value = &quot;codeCache&quot;, key = &quot;#id&quot;, cacheManager = &quot;cacheManager&quot;)</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getCode</span><span class="hljs-params">(<span class="hljs-keyword">int</span> id)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> codeMap.get(id);<br>&#125;<br></code></pre></div></td></tr></table></figure>

<h3 id="cacheResolver"><a href="#cacheResolver" class="headerlink" title="cacheResolver"></a>cacheResolver</h3><p><strong>定义</strong>：<code>cacheResolver</code>属性用于指定一个<code>CacheResolver</code>实例，<code>CacheResolver</code>负责在运行时解析使用哪个缓存。它提供了一种更灵活的方式来动态决定缓存。</p>
<p><strong>用途</strong>：<code>cacheResolver</code>在需要根据特定条件动态决定使用哪个缓存时非常有用，例如，基于方法的输入参数或者其他运行时数据。这使得它在复杂逻辑或动态环境中尤其有用。</p>
<p><strong>示例</strong>：使用<code>cacheResolver</code>动态解析缓存。</p>
<ol>
<li><p>定义一个动态解析器<code>CodeDynamicCacheResolver</code>，这个解析器重写了获取缓存的方法</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CodeDynamicCacheResolver</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SimpleCacheResolver</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">CacheResolver</span> </span>&#123;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">CodeDynamicCacheResolver</span><span class="hljs-params">(CacheManager cacheManager)</span> </span>&#123;<br>        <span class="hljs-keyword">super</span>(cacheManager);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">protected</span> Collection&lt;String&gt; <span class="hljs-title">getCacheNames</span><span class="hljs-params">(CacheOperationInvocationContext&lt;?&gt; context)</span> </span>&#123;<br>        <span class="hljs-comment">// 假设第一方法的第一个参数都是id</span><br>        <span class="hljs-keyword">int</span> key = (<span class="hljs-keyword">int</span>) context.getArgs()[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">if</span> (key &gt; <span class="hljs-number">10000</span>) &#123;<br>            <span class="hljs-keyword">return</span> Collections.singleton(<span class="hljs-string">&quot;code::big&quot;</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Collections.singleton(<span class="hljs-string">&quot;code::small&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>Spring中定义<code>codeDynamicCacheResolver</code>这个Bean</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> CodeDynamicCacheResolver <span class="hljs-title">codeDynamicCacheResolver</span><span class="hljs-params">(CacheManager cacheManager)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> CodeDynamicCacheResolver(cacheManager);<br>&#125;<br></code></pre></div></td></tr></table></figure></li>
<li><p>在<code>Spring Cache</code>注解中使用</p>
<figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-meta">@Cacheable(cacheResolver = &quot;codeDynamicCacheResolver&quot;)</span><br></code></pre></div></td></tr></table></figure></li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>cacheManager</code>用于静态地指定使用哪个缓存管理器，通常在应用启动时配置好，之后不会改变。而<code>cacheResolver</code>提供了一种动态决定使用哪个缓存的机制，它允许开发者在运行时基于复杂的业务逻辑来选择缓存。选择<code>cacheManager</code>还是<code>cacheResolver</code>取决于应用的具体需求和缓存策略的复杂程度。在多缓存管理器场景下，简单的配置可以使用<code>cacheManager</code>；而在需要高度动态和可定制的缓存解决方案中，<code>cacheResolver</code>提供了必要的灵活性。</p>
<h2 id="服务器缓存总结"><a href="#服务器缓存总结" class="headerlink" title="服务器缓存总结"></a>服务器缓存总结</h2><p>Java服务器端的缓存可以大致分为几种类型，每种类型适用于不同的场景，并具有不同的实现方式，具体的选择以及实施方案需根据应用场景和需求进行具体分析再确定。</p>
<h3 id="缓存类型"><a href="#缓存类型" class="headerlink" title="缓存类型"></a>缓存类型</h3><ul>
<li><p><strong>本地缓存</strong></p>
<ul>
<li><strong>定义</strong>：存储在单个服务实例的内存中的缓存。</li>
</ul>
<ul>
<li><p><strong>常用实现</strong>：<code>EHCache</code>、<code>Caffeine</code>。</p>
</li>
<li><p><strong>适用场景</strong>：适合非分布式或服务实例不需要共享缓存的场景。</p>
</li>
</ul>
</li>
<li><p><strong>分布式缓存</strong>:</p>
<ul>
<li><p><strong>定义</strong>：缓存数据在多个服务实例间共享，通常独立于服务实例运行。</p>
</li>
<li><p><strong>常用实现</strong>：<code>Redis</code>、<code>Memcached</code>。</p>
</li>
<li><p><strong>适用场景</strong>：适用于需要缓存共享、高可用性和扩展性的分布式系统。</p>
</li>
</ul>
</li>
<li><p><strong>数据库缓存</strong>:</p>
<ul>
<li><p><strong>定义</strong>：缓存直接与数据库交互，通常用于缓存查询结果。</p>
</li>
<li><p><strong>常用实现</strong>：<code>MyBatis</code>缓存、<code>Hibernate</code>二级缓存。</p>
</li>
<li><p><strong>适用场景</strong>：适用于减少数据库负载、提高查询效率。</p>
</li>
</ul>
</li>
</ul>
<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><ul>
<li><p><strong>EHCache</strong></p>
<ul>
<li><p><strong>特点</strong>：支持内存和磁盘存储，可配置为本地缓存。</p>
</li>
<li><p><strong>优势</strong>：易于集成，适用于单体应用或服务的本地缓存，支持复杂的缓存策略。</p>
</li>
<li><p><strong>劣势</strong>：在分布式环境中没有内建的数据一致性支持。</p>
</li>
</ul>
</li>
<li><p><strong>Redis</strong></p>
<ul>
<li><p><strong>特点</strong>：高性能键值存储数据库，支持数据结构的多样性。</p>
</li>
<li><p><strong>优势</strong>：支持持久化，数据可以在多个节点间复制，支持事务和高级数据结构，适合做分布式缓存。</p>
</li>
<li><p><strong>劣势</strong>：如果未正确配置，持久化和数据复制可能会影响性能。</p>
</li>
</ul>
</li>
<li><p><strong>Memcached</strong></p>
<ul>
<li><p><strong>特点</strong>：高性能的分布式内存对象缓存系统。</p>
</li>
<li><p><strong>优势</strong>：简单易用，适用于减轻数据库负载，提高读取速度。</p>
</li>
<li><p><strong>劣势</strong>：不支持持久化，缓存数据在重启后丢失，不支持复杂的数据类型。</p>
</li>
</ul>
</li>
<li><p><strong>MyBatis/Hibernate 缓存</strong></p>
<ul>
<li><p><strong>特点</strong>：集成在<code>ORM</code>框架中，自动处理<code>SQL</code>级别的缓存。</p>
</li>
<li><p><strong>优势</strong>：无需手动处理缓存逻辑，适合缓存数据库查询结果。</p>
</li>
<li><p><strong>劣势</strong>：控制较少，依赖于<code>ORM</code>框架的实现和配置。</p>
</li>
</ul>
</li>
</ul>
<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p>本文详细介绍了<code>Spring Cache</code>的工作原理和实践应用，展示了其如何帮助开发者优化应用性能和扩展性。随着技术的不断进步，<code>Spring Cache</code>也在不断地进化，为开发者提供更多的功能和更好的集成。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/Spring/">Spring</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Spring/">Spring</a>
                    
                      <a class="hover-with-bg" href="/tags/SpringBoot/">SpringBoot</a>
                    
                      <a class="hover-with-bg" href="/tags/%E7%BC%93%E5%AD%98/">缓存</a>
                    
                      <a class="hover-with-bg" href="/tags/%E6%80%A7%E8%83%BD/">性能</a>
                    
                      <a class="hover-with-bg" href="/tags/Spring-Cache/">Spring Cache</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/08/11/alg-binary-search/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">二分查找</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/05/25/javase-threadlocal/">
                        <span class="hidden-mobile">ThreadLocal详解</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                  
                
                
  <script type="text/javascript">
    Fluid.utils.loadComments('#comments', function() {
      var light = 'github-light';
      var dark = 'github-dark';
      var schema = document.documentElement.getAttribute('data-user-color-scheme');
      if (schema === 'dark') {
        schema = dark;
      } else {
        schema = light;
      }
      window.UtterancesThemeLight = light;
      window.UtterancesThemeDark = dark;
      var s = document.createElement('script');
      s.setAttribute('src', 'https://utteranc.es/client.js');
      s.setAttribute('repo', 'iyangtao/iyangtao.github.io');
      s.setAttribute('issue-term', 'pathname');
      
      s.setAttribute('label', 'utterances');
      
      s.setAttribute('theme', schema);
      s.setAttribute('crossorigin', 'anonymous');
      document.getElementById('comments').appendChild(s);
    })
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <span>power by: </span> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span><u>Hexo</u></span></a> <span> - </span> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span><u>Fluid</u></span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>





  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>









  <script  src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js" ></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize(null);
    }
  </script>




  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
